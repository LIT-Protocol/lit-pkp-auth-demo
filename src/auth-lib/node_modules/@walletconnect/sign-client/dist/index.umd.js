(function(Oe,et){typeof exports=="object"&&typeof module<"u"?et(exports):typeof define=="function"&&define.amd?define(["exports"],et):(Oe=typeof globalThis<"u"?globalThis:Oe||self,et(Oe["@walletconnect/sign-client"]={}))})(this,function(Oe){"use strict";var et=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zt(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var ht={exports:{}},tr=typeof Reflect=="object"?Reflect:null,jn=tr&&typeof tr.apply=="function"?tr.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},qr;tr&&typeof tr.ownKeys=="function"?qr=tr.ownKeys:Object.getOwnPropertySymbols?qr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:qr=function(e){return Object.getOwnPropertyNames(e)};function nc(t){console&&console.warn&&console.warn(t)}var Bn=Number.isNaN||function(e){return e!==e};function xe(){xe.init.call(this)}ht.exports=xe,ht.exports.once=cc,xe.EventEmitter=xe,xe.prototype._events=void 0,xe.prototype._eventsCount=0,xe.prototype._maxListeners=void 0;var qn=10;function zr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(xe,"defaultMaxListeners",{enumerable:!0,get:function(){return qn},set:function(t){if(typeof t!="number"||t<0||Bn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");qn=t}}),xe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},xe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Bn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function zn(t){return t._maxListeners===void 0?xe.defaultMaxListeners:t._maxListeners}xe.prototype.getMaxListeners=function(){return zn(this)},xe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var h=s[e];if(h===void 0)return!1;if(typeof h=="function")jn(h,this,r);else for(var l=h.length,p=Wn(h,l),i=0;i<l;++i)jn(p[i],this,r);return!0};function Kn(t,e,r,i){var n,s,a;if(zr(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]),a===void 0)a=s[e]=r,++t._eventsCount;else if(typeof a=="function"?a=s[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),n=zn(t),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,nc(c)}return t}xe.prototype.addListener=function(e,r){return Kn(this,e,r,!1)},xe.prototype.on=xe.prototype.addListener,xe.prototype.prependListener=function(e,r){return Kn(this,e,r,!0)};function sc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Hn(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=sc.bind(i);return n.listener=r,i.wrapFn=n,n}xe.prototype.once=function(e,r){return zr(r),this.on(e,Hn(this,e,r)),this},xe.prototype.prependOnceListener=function(e,r){return zr(r),this.prependListener(e,Hn(this,e,r)),this},xe.prototype.removeListener=function(e,r){var i,n,s,a,c;if(zr(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===r||i[a].listener===r){c=i[a].listener,s=a;break}if(s<0)return this;s===0?i.shift():oc(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this},xe.prototype.off=xe.prototype.removeListener,xe.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function Vn(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?ac(n):Wn(n,n.length)}xe.prototype.listeners=function(e){return Vn(this,e,!0)},xe.prototype.rawListeners=function(e){return Vn(this,e,!1)},xe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Gn.call(t,e)},xe.prototype.listenerCount=Gn;function Gn(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}xe.prototype.eventNames=function(){return this._eventsCount>0?qr(this._events):[]};function Wn(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function oc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function ac(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function cc(t,e){return new Promise(function(r,i){function n(a){t.removeListener(e,s),i(a)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}kn(t,e,s,{once:!0}),e!=="error"&&uc(t,n,{once:!0})})}function uc(t,e,r){typeof t.on=="function"&&kn(t,"error",e,r)}function kn(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Kr={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var mi=function(t,e){return mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},mi(t,e)};function lc(t,e){mi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ei=function(){return Ei=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ei.apply(this,arguments)};function hc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function fc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function dc(t,e){return function(r,i){e(r,i,t)}}function pc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function gc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(p){try{l(i.next(p))}catch(m){a(m)}}function h(p){try{l(i.throw(p))}catch(m){a(m)}}function l(p){p.done?s(p.value):n(p.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function yc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(p){return h([l,p])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(p){l=[6,p],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _c(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function bc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Si(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yn(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function wc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Yn(arguments[e]));return t}function vc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function dr(t){return this instanceof dr?(this.v=t,this):new dr(t)}function mc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(v){return new Promise(function(S,A){s.push([y,v,S,A])>1||c(y,v)})})}function c(y,v){try{h(i[y](v))}catch(S){m(s[0][3],S)}}function h(y){y.value instanceof dr?Promise.resolve(y.value.v).then(l,p):m(s[0][2],y)}function l(y){c("next",y)}function p(y){c("throw",y)}function m(y,v){y(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Ec(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:dr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function Sc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Si=="function"?Si(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Dc(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Oc(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function xc(t){return t&&t.__esModule?t:{default:t}}function Ic(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Tc(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Nc=Object.freeze({__proto__:null,__extends:lc,get __assign(){return Ei},__rest:hc,__decorate:fc,__param:dc,__metadata:pc,__awaiter:gc,__generator:yc,__createBinding:_c,__exportStar:bc,__values:Si,__read:Yn,__spread:wc,__spreadArrays:vc,__await:dr,__asyncGenerator:mc,__asyncDelegator:Ec,__asyncValues:Sc,__makeTemplateObject:Dc,__importStar:Oc,__importDefault:xc,__classPrivateFieldGet:Ic,__classPrivateFieldSet:Tc}),Xn=zt(Nc),pr={};Object.defineProperty(pr,"__esModule",{value:!0});function Rc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}pr.safeJsonParse=Rc;function Ac(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}pr.safeJsonStringify=Ac;var gr={exports:{}},Jn;function Pc(){return Jn||(Jn=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof et<"u"&&et.localStorage?gr.exports=et.localStorage:typeof window<"u"&&window.localStorage?gr.exports=window.localStorage:gr.exports=new e}()),gr.exports}var Di={},yr={},Qn;function Cc(){if(Qn)return yr;Qn=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.IKeyValueStorage=void 0;class t{}return yr.IKeyValueStorage=t,yr}var _r={},Zn;function Lc(){if(Zn)return _r;Zn=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.parseEntry=void 0;const t=pr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return _r.parseEntry=e,_r}var es;function Fc(){return es||(es=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Xn;e.__exportStar(Cc(),t),e.__exportStar(Lc(),t)}(Di)),Di}Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.KeyValueStorage=void 0;const rr=Xn,ts=pr,Uc=rr.__importDefault(Pc()),$c=Fc();class rs{constructor(){this.localStorage=Uc.default}getKeys(){return rr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return rr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map($c.parseEntry)})}getItem(e){return rr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return ts.safeJsonParse(r)})}setItem(e,r){return rr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,ts.safeJsonStringify(r))})}removeItem(e){return rr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Kr.KeyValueStorage=rs;var Mc=Kr.default=rs,ir={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Oi=function(t,e){return Oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Oi(t,e)};function jc(t,e){Oi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var xi=function(){return xi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},xi.apply(this,arguments)};function Bc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function qc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function zc(t,e){return function(r,i){e(r,i,t)}}function Kc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Hc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(p){try{l(i.next(p))}catch(m){a(m)}}function h(p){try{l(i.throw(p))}catch(m){a(m)}}function l(p){p.done?s(p.value):n(p.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function Vc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(p){return h([l,p])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(p){l=[6,p],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Gc(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Wc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ii(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function is(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function kc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(is(arguments[e]));return t}function Yc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function br(t){return this instanceof br?(this.v=t,this):new br(t)}function Xc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(v){return new Promise(function(S,A){s.push([y,v,S,A])>1||c(y,v)})})}function c(y,v){try{h(i[y](v))}catch(S){m(s[0][3],S)}}function h(y){y.value instanceof br?Promise.resolve(y.value.v).then(l,p):m(s[0][2],y)}function l(y){c("next",y)}function p(y){c("throw",y)}function m(y,v){y(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Jc(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:br(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function Qc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ii=="function"?Ii(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Zc(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function eu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function tu(t){return t&&t.__esModule?t:{default:t}}function ru(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function iu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var nu=Object.freeze({__proto__:null,__extends:jc,get __assign(){return xi},__rest:Bc,__decorate:qc,__param:zc,__metadata:Kc,__awaiter:Hc,__generator:Vc,__createBinding:Gc,__exportStar:Wc,__values:Ii,__read:is,__spread:kc,__spreadArrays:Yc,__await:br,__asyncGenerator:Xc,__asyncDelegator:Jc,__asyncValues:Qc,__makeTemplateObject:Zc,__importStar:eu,__importDefault:tu,__classPrivateFieldGet:ru,__classPrivateFieldSet:iu}),Hr=zt(nu),wr={},Q={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ti=function(t,e){return Ti=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ti(t,e)};function su(t,e){Ti(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ni=function(){return Ni=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ni.apply(this,arguments)};function ou(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function au(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function cu(t,e){return function(r,i){e(r,i,t)}}function uu(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function lu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(p){try{l(i.next(p))}catch(m){a(m)}}function h(p){try{l(i.throw(p))}catch(m){a(m)}}function l(p){p.done?s(p.value):n(p.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function hu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(p){return h([l,p])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(p){l=[6,p],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function fu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function du(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ri(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ns(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function pu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ns(arguments[e]));return t}function gu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function vr(t){return this instanceof vr?(this.v=t,this):new vr(t)}function yu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(v){return new Promise(function(S,A){s.push([y,v,S,A])>1||c(y,v)})})}function c(y,v){try{h(i[y](v))}catch(S){m(s[0][3],S)}}function h(y){y.value instanceof vr?Promise.resolve(y.value.v).then(l,p):m(s[0][2],y)}function l(y){c("next",y)}function p(y){c("throw",y)}function m(y,v){y(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function _u(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:vr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function bu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ri=="function"?Ri(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function wu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function vu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function mu(t){return t&&t.__esModule?t:{default:t}}function Eu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Su(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Du=Object.freeze({__proto__:null,__extends:su,get __assign(){return Ni},__rest:ou,__decorate:au,__param:cu,__metadata:uu,__awaiter:lu,__generator:hu,__createBinding:fu,__exportStar:du,__values:Ri,__read:ns,__spread:pu,__spreadArrays:gu,__await:vr,__asyncGenerator:yu,__asyncDelegator:_u,__asyncValues:bu,__makeTemplateObject:wu,__importStar:vu,__importDefault:mu,__classPrivateFieldGet:Eu,__classPrivateFieldSet:Su}),Vr=zt(Du),Ai={},mr={},ss;function Ou(){if(ss)return mr;ss=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return mr.delay=t,mr}var Kt={},Pi={},Ht={},os;function xu(){return os||(os=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.ONE_THOUSAND=Ht.ONE_HUNDRED=void 0,Ht.ONE_HUNDRED=100,Ht.ONE_THOUSAND=1e3),Ht}var Ci={},as;function Iu(){return as||(as=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Ci)),Ci}var cs;function us(){return cs||(cs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Vr;e.__exportStar(xu(),t),e.__exportStar(Iu(),t)}(Pi)),Pi}var ls;function Tu(){if(ls)return Kt;ls=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.fromMiliseconds=Kt.toMiliseconds=void 0;const t=us();function e(i){return i*t.ONE_THOUSAND}Kt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Kt.fromMiliseconds=r,Kt}var hs;function Nu(){return hs||(hs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Vr;e.__exportStar(Ou(),t),e.__exportStar(Tu(),t)}(Ai)),Ai}var nr={},fs;function Ru(){if(fs)return nr;fs=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return nr.Watch=t,nr.default=t,nr}var Li={},Er={},ds;function Au(){if(ds)return Er;ds=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.IWatch=void 0;class t{}return Er.IWatch=t,Er}var ps;function Pu(){return ps||(ps=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Vr.__exportStar(Au(),t)}(Li)),Li}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Vr;e.__exportStar(Nu(),t),e.__exportStar(Ru(),t),e.__exportStar(Pu(),t),e.__exportStar(us(),t)})(Q);var Fi={},Sr={};class Vt{}var Cu=Object.freeze({__proto__:null,IEvents:Vt}),Lu=zt(Cu),gs;function Fu(){if(gs)return Sr;gs=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.IHeartBeat=void 0;const t=Lu;class e extends t.IEvents{constructor(i){super()}}return Sr.IHeartBeat=e,Sr}var ys;function _s(){return ys||(ys=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Hr.__exportStar(Fu(),t)}(Fi)),Fi}var Ui={},Gt={},bs;function Uu(){if(bs)return Gt;bs=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.HEARTBEAT_EVENTS=Gt.HEARTBEAT_INTERVAL=void 0;const t=Q;return Gt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Gt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Gt}var ws;function vs(){return ws||(ws=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Hr.__exportStar(Uu(),t)}(Ui)),Ui}var ms;function $u(){if(ms)return wr;ms=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.HeartBeat=void 0;const t=Hr,e=ht.exports,r=Q,i=_s(),n=vs();class s extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=c?.interval||n.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const h=new s(c);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return wr.HeartBeat=s,wr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Hr;e.__exportStar($u(),t),e.__exportStar(_s(),t),e.__exportStar(vs(),t)})(ir);var _e={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var $i=function(t,e){return $i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},$i(t,e)};function Mu(t,e){$i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Mi=function(){return Mi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Mi.apply(this,arguments)};function ju(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Bu(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function qu(t,e){return function(r,i){e(r,i,t)}}function zu(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Ku(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(p){try{l(i.next(p))}catch(m){a(m)}}function h(p){try{l(i.throw(p))}catch(m){a(m)}}function l(p){p.done?s(p.value):n(p.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function Hu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(p){return h([l,p])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(p){l=[6,p],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Vu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Gu(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ji(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Es(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Wu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Es(arguments[e]));return t}function ku(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Dr(t){return this instanceof Dr?(this.v=t,this):new Dr(t)}function Yu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(v){return new Promise(function(S,A){s.push([y,v,S,A])>1||c(y,v)})})}function c(y,v){try{h(i[y](v))}catch(S){m(s[0][3],S)}}function h(y){y.value instanceof Dr?Promise.resolve(y.value.v).then(l,p):m(s[0][2],y)}function l(y){c("next",y)}function p(y){c("throw",y)}function m(y,v){y(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Xu(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Dr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function Ju(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ji=="function"?ji(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Qu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Zu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function el(t){return t&&t.__esModule?t:{default:t}}function tl(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function rl(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var il=Object.freeze({__proto__:null,__extends:Mu,get __assign(){return Mi},__rest:ju,__decorate:Bu,__param:qu,__metadata:zu,__awaiter:Ku,__generator:Hu,__createBinding:Vu,__exportStar:Gu,__values:ji,__read:Es,__spread:Wu,__spreadArrays:ku,__await:Dr,__asyncGenerator:Yu,__asyncDelegator:Xu,__asyncValues:Ju,__makeTemplateObject:Qu,__importStar:Zu,__importDefault:el,__classPrivateFieldGet:tl,__classPrivateFieldSet:rl}),nl=zt(il),Bi,Ss;function sl(){if(Ss)return Bi;Ss=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Bi=e;function e(r,i,n){var s=n&&n.stringify||t,a=1;if(typeof r=="object"&&r!==null){var c=i.length+a;if(c===1)return r;var h=new Array(c);h[0]=s(r);for(var l=1;l<c;l++)h[l]=s(i[l]);return h.join(" ")}if(typeof r!="string")return r;var p=i.length;if(p===0)return r;for(var m="",y=1-a,v=-1,S=r&&r.length||0,A=0;A<S;){if(r.charCodeAt(A)===37&&A+1<S){switch(v=v>-1?v:0,r.charCodeAt(A+1)){case 100:case 102:if(y>=p||i[y]==null)break;v<A&&(m+=r.slice(v,A)),m+=Number(i[y]),v=A+2,A++;break;case 105:if(y>=p||i[y]==null)break;v<A&&(m+=r.slice(v,A)),m+=Math.floor(Number(i[y])),v=A+2,A++;break;case 79:case 111:case 106:if(y>=p||i[y]===void 0)break;v<A&&(m+=r.slice(v,A));var P=typeof i[y];if(P==="string"){m+="'"+i[y]+"'",v=A+2,A++;break}if(P==="function"){m+=i[y].name||"<anonymous>",v=A+2,A++;break}m+=s(i[y]),v=A+2,A++;break;case 115:if(y>=p)break;v<A&&(m+=r.slice(v,A)),m+=String(i[y]),v=A+2,A++;break;case 37:v<A&&(m+=r.slice(v,A)),m+="%",v=A+2,A++,y--;break}++y}++A}return v===-1?r:(v<S&&(m+=r.slice(v)),m)}return Bi}var qi,Ds;function ol(){if(Ds)return qi;Ds=1;const t=sl();qi=n;const e=w().console||{},r={mapHttpRequest:S,mapHttpResponse:S,wrapRequestSerializer:A,wrapResponseSerializer:A,wrapErrorSerializer:A,req:S,res:S,err:y};function i(d,o){return Array.isArray(d)?d.filter(function(C){return C!=="!stdSerializers.err"}):d===!0?Object.keys(o):!1}function n(d){d=d||{},d.browser=d.browser||{};const o=d.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const f=d.browser.write||e;d.browser.write&&(d.browser.asObject=!0);const C=d.serializers||{},L=i(d.browser.serialize,C);let K=d.browser.serialize;Array.isArray(d.browser.serialize)&&d.browser.serialize.indexOf("!stdSerializers.err")>-1&&(K=!1);const G=["error","fatal","warn","info","debug","trace"];typeof f=="function"&&(f.error=f.fatal=f.warn=f.info=f.debug=f.trace=f),d.enabled===!1&&(d.level="silent");const J=d.level||"info",x=Object.create(f);x.log||(x.log=P),Object.defineProperty(x,"levelVal",{get:W}),Object.defineProperty(x,"level",{get:j,set:U});const R={transmit:o,serialize:L,asObject:d.browser.asObject,levels:G,timestamp:v(d)};x.levels=n.levels,x.level=J,x.setMaxListeners=x.getMaxListeners=x.emit=x.addListener=x.on=x.prependListener=x.once=x.prependOnceListener=x.removeListener=x.removeAllListeners=x.listeners=x.listenerCount=x.eventNames=x.write=x.flush=P,x.serializers=C,x._serialize=L,x._stdErrSerialize=K,x.child=M,o&&(x._logEvent=m());function W(){return this.level==="silent"?1/0:this.levels.values[this.level]}function j(){return this._level}function U(F){if(F!=="silent"&&!this.levels.values[F])throw Error("unknown level "+F);this._level=F,s(R,x,"error","log"),s(R,x,"fatal","error"),s(R,x,"warn","error"),s(R,x,"info","log"),s(R,x,"debug","log"),s(R,x,"trace","log")}function M(F,B){if(!F)throw new Error("missing bindings for child Pino");B=B||{},L&&F.serializers&&(B.serializers=F.serializers);const te=B.serializers;if(L&&te){var q=Object.assign({},C,te),Z=d.browser.serialize===!0?Object.keys(q):L;delete F.serializers,h([F],Z,q,this._stdErrSerialize)}function Y(ee){this._childLevel=(ee._childLevel|0)+1,this.error=l(ee,F,"error"),this.fatal=l(ee,F,"fatal"),this.warn=l(ee,F,"warn"),this.info=l(ee,F,"info"),this.debug=l(ee,F,"debug"),this.trace=l(ee,F,"trace"),q&&(this.serializers=q,this._serialize=Z),o&&(this._logEvent=m([].concat(ee._logEvent.bindings,F)))}return Y.prototype=this,new Y(this)}return x}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:z,epochTime:E,unixTime:I,isoTime:_});function s(d,o,f,C){const L=Object.getPrototypeOf(o);o[f]=o.levelVal>o.levels.values[f]?P:L[f]?L[f]:e[f]||e[C]||P,a(d,o,f)}function a(d,o,f){!d.transmit&&o[f]===P||(o[f]=function(C){return function(){const K=d.timestamp(),G=new Array(arguments.length),J=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var x=0;x<G.length;x++)G[x]=arguments[x];if(d.serialize&&!d.asObject&&h(G,this._serialize,this.serializers,this._stdErrSerialize),d.asObject?C.call(J,c(this,f,G,K)):C.apply(J,G),d.transmit){const R=d.transmit.level||o.level,W=n.levels.values[R],j=n.levels.values[f];if(j<W)return;p(this,{ts:K,methodLevel:f,methodValue:j,transmitLevel:R,transmitValue:n.levels.values[d.transmit.level||o.level],send:d.transmit.send,val:o.levelVal},G)}}}(o[f]))}function c(d,o,f,C){d._serialize&&h(f,d._serialize,d.serializers,d._stdErrSerialize);const L=f.slice();let K=L[0];const G={};C&&(G.time=C),G.level=n.levels.values[o];let J=(d._childLevel|0)+1;if(J<1&&(J=1),K!==null&&typeof K=="object"){for(;J--&&typeof L[0]=="object";)Object.assign(G,L.shift());K=L.length?t(L.shift(),L):void 0}else typeof K=="string"&&(K=t(L.shift(),L));return K!==void 0&&(G.msg=K),G}function h(d,o,f,C){for(const L in d)if(C&&d[L]instanceof Error)d[L]=n.stdSerializers.err(d[L]);else if(typeof d[L]=="object"&&!Array.isArray(d[L]))for(const K in d[L])o&&o.indexOf(K)>-1&&K in f&&(d[L][K]=f[K](d[L][K]))}function l(d,o,f){return function(){const C=new Array(1+arguments.length);C[0]=o;for(var L=1;L<C.length;L++)C[L]=arguments[L-1];return d[f].apply(this,C)}}function p(d,o,f){const C=o.send,L=o.ts,K=o.methodLevel,G=o.methodValue,J=o.val,x=d._logEvent.bindings;h(f,d._serialize||Object.keys(d.serializers),d.serializers,d._stdErrSerialize===void 0?!0:d._stdErrSerialize),d._logEvent.ts=L,d._logEvent.messages=f.filter(function(R){return x.indexOf(R)===-1}),d._logEvent.level.label=K,d._logEvent.level.value=G,C(K,d._logEvent,J),d._logEvent=m(x)}function m(d){return{ts:0,messages:[],bindings:d||[],level:{label:"",value:0}}}function y(d){const o={type:d.constructor.name,msg:d.message,stack:d.stack};for(const f in d)o[f]===void 0&&(o[f]=d[f]);return o}function v(d){return typeof d.timestamp=="function"?d.timestamp:d.timestamp===!1?z:E}function S(){return{}}function A(d){return d}function P(){}function z(){return!1}function E(){return Date.now()}function I(){return Math.round(Date.now()/1e3)}function _(){return new Date(Date.now()).toISOString()}function w(){function d(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return d(self)||d(window)||d(this)||{}}}return qi}var Wt={},Os;function xs(){return Os||(Os=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.PINO_CUSTOM_CONTEXT_KEY=Wt.PINO_LOGGER_DEFAULTS=void 0,Wt.PINO_LOGGER_DEFAULTS={level:"info"},Wt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Wt}var ot={},Is;function al(){if(Is)return ot;Is=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.generateChildLogger=ot.formatChildLoggerContext=ot.getLoggerContext=ot.setBrowserLoggerContext=ot.getBrowserLoggerContext=ot.getDefaultLoggerOptions=void 0;const t=xs();function e(c){return Object.assign(Object.assign({},c),{level:c?.level||t.PINO_LOGGER_DEFAULTS.level})}ot.getDefaultLoggerOptions=e;function r(c,h=t.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}ot.getBrowserLoggerContext=r;function i(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){return c[l]=h,c}ot.setBrowserLoggerContext=i;function n(c,h=t.PINO_CUSTOM_CONTEXT_KEY){let l="";return typeof c.bindings>"u"?l=r(c,h):l=c.bindings().context||"",l}ot.getLoggerContext=n;function s(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){const p=n(c,l);return p.trim()?`${p}/${h}`:h}ot.formatChildLoggerContext=s;function a(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){const p=s(c,h,l),m=c.child({context:p});return i(m,p,l)}return ot.generateChildLogger=a,ot}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=nl,r=e.__importDefault(ol());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(xs(),t),e.__exportStar(al(),t)})(_e);class cl extends Vt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class ul extends Vt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class ll{constructor(e,r){this.logger=e,this.core=r}}class hl extends Vt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class fl extends Vt{constructor(e){super()}}class dl{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class pl extends Vt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class gl extends Vt{constructor(e,r){super(),this.core=e,this.logger=r}}class yl{constructor(e,r){this.projectId=e,this.logger=r}}class _l{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class bl{constructor(e){this.client=e}}const wl=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),vl=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Ts(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return vl(t)}catch{return t}}function zi(t){return typeof t=="string"?t:wl(t)||""}var Ki={},sr={},Gr={},Wr={};Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.BrowserRandomSource=void 0;const Ns=65536;class ml{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Ns)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Ns)));return r}}Wr.BrowserRandomSource=ml;function El(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var kr={},pt={};Object.defineProperty(pt,"__esModule",{value:!0});function Sl(t){for(var e=0;e<t.length;e++)t[e]=0;return t}pt.wipe=Sl;var Dl={},Ol=Object.freeze({__proto__:null,default:Dl}),xl=zt(Ol);Object.defineProperty(kr,"__esModule",{value:!0}),kr.NodeRandomSource=void 0;const Il=pt;class Tl{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof El<"u"){const e=xl;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,Il.wipe)(r),i}}kr.NodeRandomSource=Tl,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.SystemRandomSource=void 0;const Nl=Wr,Rl=kr;class Al{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Nl.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Rl.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Gr.SystemRandomSource=Al;var ie={},Rs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,h){var l=c>>>16&65535,p=c&65535,m=h>>>16&65535,y=h&65535;return p*y+(l*y+p*m<<16>>>0)|0}t.mul=Math.imul||e;function r(c,h){return c+h|0}t.add=r;function i(c,h){return c-h|0}t.sub=i;function n(c,h){return c<<h|c>>>32-h}t.rotl=n;function s(c,h){return c<<32-h|c>>>h}t.rotr=s;function a(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||a,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(Rs),Object.defineProperty(ie,"__esModule",{value:!0});var As=Rs;function Pl(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ie.readInt16BE=Pl;function Cl(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ie.readUint16BE=Cl;function Ll(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ie.readInt16LE=Ll;function Fl(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ie.readUint16LE=Fl;function Ps(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ie.writeUint16BE=Ps,ie.writeInt16BE=Ps;function Cs(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ie.writeUint16LE=Cs,ie.writeInt16LE=Cs;function Hi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ie.readInt32BE=Hi;function Vi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ie.readUint32BE=Vi;function Gi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ie.readInt32LE=Gi;function Wi(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ie.readUint32LE=Wi;function Yr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ie.writeUint32BE=Yr,ie.writeInt32BE=Yr;function Xr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ie.writeUint32LE=Xr,ie.writeInt32LE=Xr;function Ul(t,e){e===void 0&&(e=0);var r=Hi(t,e),i=Hi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=Ul;function $l(t,e){e===void 0&&(e=0);var r=Vi(t,e),i=Vi(t,e+4);return r*4294967296+i}ie.readUint64BE=$l;function Ml(t,e){e===void 0&&(e=0);var r=Gi(t,e),i=Gi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ie.readInt64LE=Ml;function jl(t,e){e===void 0&&(e=0);var r=Wi(t,e),i=Wi(t,e+4);return i*4294967296+r}ie.readUint64LE=jl;function Ls(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Yr(t/4294967296>>>0,e,r),Yr(t>>>0,e,r+4),e}ie.writeUint64BE=Ls,ie.writeInt64BE=Ls;function Fs(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Xr(t>>>0,e,r),Xr(t/4294967296>>>0,e,r+4),e}ie.writeUint64LE=Fs,ie.writeInt64LE=Fs;function Bl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,s=t/8+r-1;s>=r;s--)i+=e[s]*n,n*=256;return i}ie.readUintBE=Bl;function ql(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,s=r;s<r+t/8;s++)i+=e[s]*n,n*=256;return i}ie.readUintLE=ql;function zl(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!As.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,s=t/8+i-1;s>=i;s--)r[s]=e/n&255,n*=256;return r}ie.writeUintBE=zl;function Kl(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!As.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,s=i;s<i+t/8;s++)r[s]=e/n&255,n*=256;return r}ie.writeUintLE=Kl;function Hl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ie.readFloat32BE=Hl;function Vl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ie.readFloat32LE=Vl;function Gl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ie.readFloat64BE=Gl;function Wl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ie.readFloat64LE=Wl;function kl(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ie.writeFloat32BE=kl;function Yl(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ie.writeFloat32LE=Yl;function Xl(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ie.writeFloat64BE=Xl;function Jl(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ie.writeFloat64LE=Jl,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Gr,r=ie,i=pt;t.defaultRandomSource=new e.SystemRandomSource;function n(l,p=t.defaultRandomSource){return p.randomBytes(l)}t.randomBytes=n;function s(l=t.defaultRandomSource){const p=n(4,l),m=(0,r.readUint32LE)(p);return(0,i.wipe)(p),m}t.randomUint32=s;const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(l,p=a,m=t.defaultRandomSource){if(p.length<2)throw new Error("randomString charset is too short");if(p.length>256)throw new Error("randomString charset is too long");let y="";const v=p.length,S=256-256%v;for(;l>0;){const A=n(Math.ceil(l*256/S),m);for(let P=0;P<A.length&&l>0;P++){const z=A[P];z<S&&(y+=p.charAt(z%v),l--)}(0,i.wipe)(A)}return y}t.randomString=c;function h(l,p=a,m=t.defaultRandomSource){const y=Math.ceil(l/(Math.log(p.length)/Math.LN2));return c(y,p,m)}t.randomStringForEntropy=h}(sr);var Us={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=pt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,l){if(l===void 0&&(l=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var p=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&l>0;)this._buffer[this._bufferLength++]=h[p++],l--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(p=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,p,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=h[p++],l--;return this},c.prototype.finish=function(h){if(!this._finished){var l=this._bytesHashed,p=this._bufferLength,m=l/536870912|0,y=l<<3,v=l%128<112?128:256;this._buffer[p]=128;for(var S=p+1;S<v-8;S++)this._buffer[S]=0;e.writeUint32BE(m,this._buffer,v-8),e.writeUint32BE(y,this._buffer,v-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var S=0;S<this.digestLength/8;S++)e.writeUint32BE(this._stateHi[S],h,S*8),e.writeUint32BE(this._stateLo[S],h,S*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(c,h,l,p,m,y,v){for(var S=l[0],A=l[1],P=l[2],z=l[3],E=l[4],I=l[5],_=l[6],w=l[7],d=p[0],o=p[1],f=p[2],C=p[3],L=p[4],K=p[5],G=p[6],J=p[7],x,R,W,j,U,M,F,B;v>=128;){for(var te=0;te<16;te++){var q=8*te+y;c[te]=e.readUint32BE(m,q),h[te]=e.readUint32BE(m,q+4)}for(var te=0;te<80;te++){var Z=S,Y=A,ee=P,N=z,T=E,D=I,u=_,b=w,H=d,k=o,he=f,be=C,de=L,me=K,Ue=G,Pe=J;if(x=w,R=J,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=(E>>>14|L<<32-14)^(E>>>18|L<<32-18)^(L>>>41-32|E<<32-(41-32)),R=(L>>>14|E<<32-14)^(L>>>18|E<<32-18)^(E>>>41-32|L<<32-(41-32)),U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,x=E&I^~E&_,R=L&K^~L&G,U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,x=n[te*2],R=n[te*2+1],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,x=c[te%16],R=h[te%16],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,W=F&65535|B<<16,j=U&65535|M<<16,x=W,R=j,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=(S>>>28|d<<32-28)^(d>>>34-32|S<<32-(34-32))^(d>>>39-32|S<<32-(39-32)),R=(d>>>28|S<<32-28)^(S>>>34-32|d<<32-(34-32))^(S>>>39-32|d<<32-(39-32)),U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,x=S&A^S&P^A&P,R=d&o^d&f^o&f,U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,b=F&65535|B<<16,Pe=U&65535|M<<16,x=N,R=be,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=W,R=j,U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,N=F&65535|B<<16,be=U&65535|M<<16,A=Z,P=Y,z=ee,E=N,I=T,_=D,w=u,S=b,o=H,f=k,C=he,L=be,K=de,G=me,J=Ue,d=Pe,te%16===15)for(var q=0;q<16;q++)x=c[q],R=h[q],U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=c[(q+9)%16],R=h[(q+9)%16],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,W=c[(q+1)%16],j=h[(q+1)%16],x=(W>>>1|j<<32-1)^(W>>>8|j<<32-8)^W>>>7,R=(j>>>1|W<<32-1)^(j>>>8|W<<32-8)^(j>>>7|W<<32-7),U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,W=c[(q+14)%16],j=h[(q+14)%16],x=(W>>>19|j<<32-19)^(j>>>61-32|W<<32-(61-32))^W>>>6,R=(j>>>19|W<<32-19)^(W>>>61-32|j<<32-(61-32))^(j>>>6|W<<32-6),U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,c[q]=F&65535|B<<16,h[q]=U&65535|M<<16}x=S,R=d,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[0],R=p[0],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[0]=S=F&65535|B<<16,p[0]=d=U&65535|M<<16,x=A,R=o,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[1],R=p[1],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[1]=A=F&65535|B<<16,p[1]=o=U&65535|M<<16,x=P,R=f,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[2],R=p[2],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[2]=P=F&65535|B<<16,p[2]=f=U&65535|M<<16,x=z,R=C,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[3],R=p[3],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[3]=z=F&65535|B<<16,p[3]=C=U&65535|M<<16,x=E,R=L,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[4],R=p[4],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[4]=E=F&65535|B<<16,p[4]=L=U&65535|M<<16,x=I,R=K,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[5],R=p[5],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[5]=I=F&65535|B<<16,p[5]=K=U&65535|M<<16,x=_,R=G,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[6],R=p[6],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[6]=_=F&65535|B<<16,p[6]=G=U&65535|M<<16,x=w,R=J,U=R&65535,M=R>>>16,F=x&65535,B=x>>>16,x=l[7],R=p[7],U+=R&65535,M+=R>>>16,F+=x&65535,B+=x>>>16,M+=U>>>16,F+=M>>>16,B+=F>>>16,l[7]=w=F&65535|B<<16,p[7]=J=U&65535|M<<16,y+=128,v-=128}return y}function a(c){var h=new i;h.update(c);var l=h.digest();return h.clean(),l}t.hash=a})(Us),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=sr,r=Us,i=pt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(N){const T=new Float64Array(16);if(N)for(let D=0;D<N.length;D++)T[D]=N[D];return T}const s=new Uint8Array(32);s[0]=9;const a=n(),c=n([1]),h=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),p=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),m=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),y=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(N,T){for(let D=0;D<16;D++)N[D]=T[D]|0}function S(N){let T=1;for(let D=0;D<16;D++){let u=N[D]+T+65535;T=Math.floor(u/65536),N[D]=u-T*65536}N[0]+=T-1+37*(T-1)}function A(N,T,D){const u=~(D-1);for(let b=0;b<16;b++){const H=u&(N[b]^T[b]);N[b]^=H,T[b]^=H}}function P(N,T){const D=n(),u=n();for(let b=0;b<16;b++)u[b]=T[b];S(u),S(u),S(u);for(let b=0;b<2;b++){D[0]=u[0]-65517;for(let k=1;k<15;k++)D[k]=u[k]-65535-(D[k-1]>>16&1),D[k-1]&=65535;D[15]=u[15]-32767-(D[14]>>16&1);const H=D[15]>>16&1;D[14]&=65535,A(u,D,1-H)}for(let b=0;b<16;b++)N[2*b]=u[b]&255,N[2*b+1]=u[b]>>8}function z(N,T){let D=0;for(let u=0;u<32;u++)D|=N[u]^T[u];return(1&D-1>>>8)-1}function E(N,T){const D=new Uint8Array(32),u=new Uint8Array(32);return P(D,N),P(u,T),z(D,u)}function I(N){const T=new Uint8Array(32);return P(T,N),T[0]&1}function _(N,T){for(let D=0;D<16;D++)N[D]=T[2*D]+(T[2*D+1]<<8);N[15]&=32767}function w(N,T,D){for(let u=0;u<16;u++)N[u]=T[u]+D[u]}function d(N,T,D){for(let u=0;u<16;u++)N[u]=T[u]-D[u]}function o(N,T,D){let u,b,H=0,k=0,he=0,be=0,de=0,me=0,Ue=0,Pe=0,ye=0,pe=0,fe=0,ue=0,ce=0,ae=0,oe=0,re=0,le=0,ge=0,ne=0,we=0,ve=0,Se=0,De=0,Ee=0,St=0,Tt=0,Mt=0,gt=0,Jt=0,Mr=0,pi=0,Me=D[0],Ce=D[1],je=D[2],Be=D[3],qe=D[4],Le=D[5],Ge=D[6],We=D[7],ke=D[8],Ye=D[9],Xe=D[10],Ke=D[11],ze=D[12],Ne=D[13],Je=D[14],Qe=D[15];u=T[0],H+=u*Me,k+=u*Ce,he+=u*je,be+=u*Be,de+=u*qe,me+=u*Le,Ue+=u*Ge,Pe+=u*We,ye+=u*ke,pe+=u*Ye,fe+=u*Xe,ue+=u*Ke,ce+=u*ze,ae+=u*Ne,oe+=u*Je,re+=u*Qe,u=T[1],k+=u*Me,he+=u*Ce,be+=u*je,de+=u*Be,me+=u*qe,Ue+=u*Le,Pe+=u*Ge,ye+=u*We,pe+=u*ke,fe+=u*Ye,ue+=u*Xe,ce+=u*Ke,ae+=u*ze,oe+=u*Ne,re+=u*Je,le+=u*Qe,u=T[2],he+=u*Me,be+=u*Ce,de+=u*je,me+=u*Be,Ue+=u*qe,Pe+=u*Le,ye+=u*Ge,pe+=u*We,fe+=u*ke,ue+=u*Ye,ce+=u*Xe,ae+=u*Ke,oe+=u*ze,re+=u*Ne,le+=u*Je,ge+=u*Qe,u=T[3],be+=u*Me,de+=u*Ce,me+=u*je,Ue+=u*Be,Pe+=u*qe,ye+=u*Le,pe+=u*Ge,fe+=u*We,ue+=u*ke,ce+=u*Ye,ae+=u*Xe,oe+=u*Ke,re+=u*ze,le+=u*Ne,ge+=u*Je,ne+=u*Qe,u=T[4],de+=u*Me,me+=u*Ce,Ue+=u*je,Pe+=u*Be,ye+=u*qe,pe+=u*Le,fe+=u*Ge,ue+=u*We,ce+=u*ke,ae+=u*Ye,oe+=u*Xe,re+=u*Ke,le+=u*ze,ge+=u*Ne,ne+=u*Je,we+=u*Qe,u=T[5],me+=u*Me,Ue+=u*Ce,Pe+=u*je,ye+=u*Be,pe+=u*qe,fe+=u*Le,ue+=u*Ge,ce+=u*We,ae+=u*ke,oe+=u*Ye,re+=u*Xe,le+=u*Ke,ge+=u*ze,ne+=u*Ne,we+=u*Je,ve+=u*Qe,u=T[6],Ue+=u*Me,Pe+=u*Ce,ye+=u*je,pe+=u*Be,fe+=u*qe,ue+=u*Le,ce+=u*Ge,ae+=u*We,oe+=u*ke,re+=u*Ye,le+=u*Xe,ge+=u*Ke,ne+=u*ze,we+=u*Ne,ve+=u*Je,Se+=u*Qe,u=T[7],Pe+=u*Me,ye+=u*Ce,pe+=u*je,fe+=u*Be,ue+=u*qe,ce+=u*Le,ae+=u*Ge,oe+=u*We,re+=u*ke,le+=u*Ye,ge+=u*Xe,ne+=u*Ke,we+=u*ze,ve+=u*Ne,Se+=u*Je,De+=u*Qe,u=T[8],ye+=u*Me,pe+=u*Ce,fe+=u*je,ue+=u*Be,ce+=u*qe,ae+=u*Le,oe+=u*Ge,re+=u*We,le+=u*ke,ge+=u*Ye,ne+=u*Xe,we+=u*Ke,ve+=u*ze,Se+=u*Ne,De+=u*Je,Ee+=u*Qe,u=T[9],pe+=u*Me,fe+=u*Ce,ue+=u*je,ce+=u*Be,ae+=u*qe,oe+=u*Le,re+=u*Ge,le+=u*We,ge+=u*ke,ne+=u*Ye,we+=u*Xe,ve+=u*Ke,Se+=u*ze,De+=u*Ne,Ee+=u*Je,St+=u*Qe,u=T[10],fe+=u*Me,ue+=u*Ce,ce+=u*je,ae+=u*Be,oe+=u*qe,re+=u*Le,le+=u*Ge,ge+=u*We,ne+=u*ke,we+=u*Ye,ve+=u*Xe,Se+=u*Ke,De+=u*ze,Ee+=u*Ne,St+=u*Je,Tt+=u*Qe,u=T[11],ue+=u*Me,ce+=u*Ce,ae+=u*je,oe+=u*Be,re+=u*qe,le+=u*Le,ge+=u*Ge,ne+=u*We,we+=u*ke,ve+=u*Ye,Se+=u*Xe,De+=u*Ke,Ee+=u*ze,St+=u*Ne,Tt+=u*Je,Mt+=u*Qe,u=T[12],ce+=u*Me,ae+=u*Ce,oe+=u*je,re+=u*Be,le+=u*qe,ge+=u*Le,ne+=u*Ge,we+=u*We,ve+=u*ke,Se+=u*Ye,De+=u*Xe,Ee+=u*Ke,St+=u*ze,Tt+=u*Ne,Mt+=u*Je,gt+=u*Qe,u=T[13],ae+=u*Me,oe+=u*Ce,re+=u*je,le+=u*Be,ge+=u*qe,ne+=u*Le,we+=u*Ge,ve+=u*We,Se+=u*ke,De+=u*Ye,Ee+=u*Xe,St+=u*Ke,Tt+=u*ze,Mt+=u*Ne,gt+=u*Je,Jt+=u*Qe,u=T[14],oe+=u*Me,re+=u*Ce,le+=u*je,ge+=u*Be,ne+=u*qe,we+=u*Le,ve+=u*Ge,Se+=u*We,De+=u*ke,Ee+=u*Ye,St+=u*Xe,Tt+=u*Ke,Mt+=u*ze,gt+=u*Ne,Jt+=u*Je,Mr+=u*Qe,u=T[15],re+=u*Me,le+=u*Ce,ge+=u*je,ne+=u*Be,we+=u*qe,ve+=u*Le,Se+=u*Ge,De+=u*We,Ee+=u*ke,St+=u*Ye,Tt+=u*Xe,Mt+=u*Ke,gt+=u*ze,Jt+=u*Ne,Mr+=u*Je,pi+=u*Qe,H+=38*le,k+=38*ge,he+=38*ne,be+=38*we,de+=38*ve,me+=38*Se,Ue+=38*De,Pe+=38*Ee,ye+=38*St,pe+=38*Tt,fe+=38*Mt,ue+=38*gt,ce+=38*Jt,ae+=38*Mr,oe+=38*pi,b=1,u=H+b+65535,b=Math.floor(u/65536),H=u-b*65536,u=k+b+65535,b=Math.floor(u/65536),k=u-b*65536,u=he+b+65535,b=Math.floor(u/65536),he=u-b*65536,u=be+b+65535,b=Math.floor(u/65536),be=u-b*65536,u=de+b+65535,b=Math.floor(u/65536),de=u-b*65536,u=me+b+65535,b=Math.floor(u/65536),me=u-b*65536,u=Ue+b+65535,b=Math.floor(u/65536),Ue=u-b*65536,u=Pe+b+65535,b=Math.floor(u/65536),Pe=u-b*65536,u=ye+b+65535,b=Math.floor(u/65536),ye=u-b*65536,u=pe+b+65535,b=Math.floor(u/65536),pe=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=ue+b+65535,b=Math.floor(u/65536),ue=u-b*65536,u=ce+b+65535,b=Math.floor(u/65536),ce=u-b*65536,u=ae+b+65535,b=Math.floor(u/65536),ae=u-b*65536,u=oe+b+65535,b=Math.floor(u/65536),oe=u-b*65536,u=re+b+65535,b=Math.floor(u/65536),re=u-b*65536,H+=b-1+37*(b-1),b=1,u=H+b+65535,b=Math.floor(u/65536),H=u-b*65536,u=k+b+65535,b=Math.floor(u/65536),k=u-b*65536,u=he+b+65535,b=Math.floor(u/65536),he=u-b*65536,u=be+b+65535,b=Math.floor(u/65536),be=u-b*65536,u=de+b+65535,b=Math.floor(u/65536),de=u-b*65536,u=me+b+65535,b=Math.floor(u/65536),me=u-b*65536,u=Ue+b+65535,b=Math.floor(u/65536),Ue=u-b*65536,u=Pe+b+65535,b=Math.floor(u/65536),Pe=u-b*65536,u=ye+b+65535,b=Math.floor(u/65536),ye=u-b*65536,u=pe+b+65535,b=Math.floor(u/65536),pe=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=ue+b+65535,b=Math.floor(u/65536),ue=u-b*65536,u=ce+b+65535,b=Math.floor(u/65536),ce=u-b*65536,u=ae+b+65535,b=Math.floor(u/65536),ae=u-b*65536,u=oe+b+65535,b=Math.floor(u/65536),oe=u-b*65536,u=re+b+65535,b=Math.floor(u/65536),re=u-b*65536,H+=b-1+37*(b-1),N[0]=H,N[1]=k,N[2]=he,N[3]=be,N[4]=de,N[5]=me,N[6]=Ue,N[7]=Pe,N[8]=ye,N[9]=pe,N[10]=fe,N[11]=ue,N[12]=ce,N[13]=ae,N[14]=oe,N[15]=re}function f(N,T){o(N,T,T)}function C(N,T){const D=n();let u;for(u=0;u<16;u++)D[u]=T[u];for(u=253;u>=0;u--)f(D,D),u!==2&&u!==4&&o(D,D,T);for(u=0;u<16;u++)N[u]=D[u]}function L(N,T){const D=n();let u;for(u=0;u<16;u++)D[u]=T[u];for(u=250;u>=0;u--)f(D,D),u!==1&&o(D,D,T);for(u=0;u<16;u++)N[u]=D[u]}function K(N,T){const D=n(),u=n(),b=n(),H=n(),k=n(),he=n(),be=n(),de=n(),me=n();d(D,N[1],N[0]),d(me,T[1],T[0]),o(D,D,me),w(u,N[0],N[1]),w(me,T[0],T[1]),o(u,u,me),o(b,N[3],T[3]),o(b,b,l),o(H,N[2],T[2]),w(H,H,H),d(k,u,D),d(he,H,b),w(be,H,b),w(de,u,D),o(N[0],k,he),o(N[1],de,be),o(N[2],be,he),o(N[3],k,de)}function G(N,T,D){for(let u=0;u<4;u++)A(N[u],T[u],D)}function J(N,T){const D=n(),u=n(),b=n();C(b,T[2]),o(D,T[0],b),o(u,T[1],b),P(N,u),N[31]^=I(D)<<7}function x(N,T,D){v(N[0],a),v(N[1],c),v(N[2],c),v(N[3],a);for(let u=255;u>=0;--u){const b=D[u/8|0]>>(u&7)&1;G(N,T,b),K(T,N),K(N,N),G(N,T,b)}}function R(N,T){const D=[n(),n(),n(),n()];v(D[0],p),v(D[1],m),v(D[2],c),o(D[3],p,m),x(N,D,T)}function W(N){if(N.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const T=(0,r.hash)(N);T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(32),u=[n(),n(),n(),n()];R(u,T),J(D,u);const b=new Uint8Array(64);return b.set(N),b.set(D,32),{publicKey:D,secretKey:b}}t.generateKeyPairFromSeed=W;function j(N){const T=(0,e.randomBytes)(32,N),D=W(T);return(0,i.wipe)(T),D}t.generateKeyPair=j;function U(N){if(N.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(N.subarray(32))}t.extractPublicKeyFromSecretKey=U;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function F(N,T){let D,u,b,H;for(u=63;u>=32;--u){for(D=0,b=u-32,H=u-12;b<H;++b)T[b]+=D-16*T[u]*M[b-(u-32)],D=Math.floor((T[b]+128)/256),T[b]-=D*256;T[b]+=D,T[u]=0}for(D=0,b=0;b<32;b++)T[b]+=D-(T[31]>>4)*M[b],D=T[b]>>8,T[b]&=255;for(b=0;b<32;b++)T[b]-=D*M[b];for(u=0;u<32;u++)T[u+1]+=T[u]>>8,N[u]=T[u]&255}function B(N){const T=new Float64Array(64);for(let D=0;D<64;D++)T[D]=N[D];for(let D=0;D<64;D++)N[D]=0;F(N,T)}function te(N,T){const D=new Float64Array(64),u=[n(),n(),n(),n()],b=(0,r.hash)(N.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const H=new Uint8Array(64);H.set(b.subarray(32),32);const k=new r.SHA512;k.update(H.subarray(32)),k.update(T);const he=k.digest();k.clean(),B(he),R(u,he),J(H,u),k.reset(),k.update(H.subarray(0,32)),k.update(N.subarray(32)),k.update(T);const be=k.digest();B(be);for(let de=0;de<32;de++)D[de]=he[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)D[de+me]+=be[de]*b[me];return F(H.subarray(32),D),H}t.sign=te;function q(N,T){const D=n(),u=n(),b=n(),H=n(),k=n(),he=n(),be=n();return v(N[2],c),_(N[1],T),f(b,N[1]),o(H,b,h),d(b,b,N[2]),w(H,N[2],H),f(k,H),f(he,k),o(be,he,k),o(D,be,b),o(D,D,H),L(D,D),o(D,D,b),o(D,D,H),o(D,D,H),o(N[0],D,H),f(u,N[0]),o(u,u,H),E(u,b)&&o(N[0],N[0],y),f(u,N[0]),o(u,u,H),E(u,b)?-1:(I(N[0])===T[31]>>7&&d(N[0],a,N[0]),o(N[3],N[0],N[1]),0)}function Z(N,T,D){const u=new Uint8Array(32),b=[n(),n(),n(),n()],H=[n(),n(),n(),n()];if(D.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(q(H,N))return!1;const k=new r.SHA512;k.update(D.subarray(0,32)),k.update(N),k.update(T);const he=k.digest();return B(he),x(b,H,he),R(H,D.subarray(32)),K(b,H),J(u,b),!z(D,u)}t.verify=Z;function Y(N){let T=[n(),n(),n(),n()];if(q(T,N))throw new Error("Ed25519: invalid public key");let D=n(),u=n(),b=T[1];w(D,c,b),d(u,c,b),C(u,u),o(D,D,u);let H=new Uint8Array(32);return P(H,D),H}t.convertPublicKeyToX25519=Y;function ee(N){const T=(0,r.hash)(N.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(T.subarray(0,32));return(0,i.wipe)(T),D}t.convertSecretKeyToX25519=ee}(Ki);const Ql="EdDSA",Zl="JWT",$s=".",Ms="base64url",eh="utf8",th="utf8",rh=":",ih="did",nh="key",js="base58btc",sh="z",oh="K36",ah=32;function ki(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Bs(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ki(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Yi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Bs(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return ki(r)}function ch(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=t.length,h=t.charAt(0),l=Math.log(c)/Math.log(256),p=Math.log(256)/Math.log(c);function m(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var A=0,P=0,z=0,E=S.length;z!==E&&S[z]===0;)z++,A++;for(var I=(E-z)*p+1>>>0,_=new Uint8Array(I);z!==E;){for(var w=S[z],d=0,o=I-1;(w!==0||d<P)&&o!==-1;o--,d++)w+=256*_[o]>>>0,_[o]=w%c>>>0,w=w/c>>>0;if(w!==0)throw new Error("Non-zero carry");P=d,z++}for(var f=I-P;f!==I&&_[f]===0;)f++;for(var C=h.repeat(A);f<I;++f)C+=t.charAt(_[f]);return C}function y(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var A=0;if(S[A]!==" "){for(var P=0,z=0;S[A]===h;)P++,A++;for(var E=(S.length-A)*l+1>>>0,I=new Uint8Array(E);S[A];){var _=r[S.charCodeAt(A)];if(_===255)return;for(var w=0,d=E-1;(_!==0||w<z)&&d!==-1;d--,w++)_+=c*I[d]>>>0,I[d]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");z=w,A++}if(S[A]!==" "){for(var o=E-z;o!==E&&I[o]===0;)o++;for(var f=new Uint8Array(P+(E-o)),C=P;o!==E;)f[C++]=I[o++];return f}}}function v(S){var A=y(S);if(A)return A;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:y,decode:v}}var uh=ch,lh=uh;const qs=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},hh=t=>new TextEncoder().encode(t),fh=t=>new TextDecoder().decode(t);class dh{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ph{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zs(this,e)}}class gh{constructor(e){this.decoders=e}or(e){return zs(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const zs=(t,e)=>new gh({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class yh{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new dh(e,r,i),this.decoder=new ph(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Jr=({name:t,prefix:e,encode:r,decode:i})=>new yh(t,e,r,i),Or=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=lh(r,e);return Jr({prefix:t,name:e,encode:i,decode:s=>qs(n(s))})},_h=(t,e,r,i)=>{const n={};for(let p=0;p<e.length;++p)n[e[p]]=p;let s=t.length;for(;t[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,h=0,l=0;for(let p=0;p<s;++p){const m=n[t[p]];if(m===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|m,c+=r,c>=8&&(c-=8,a[l++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return a},bh=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],a+=8;a>r;)a-=r,s+=e[n&c>>a];if(a&&(s+=e[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},tt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Jr({prefix:e,name:t,encode(n){return bh(n,i,r)},decode(n){return _h(n,i,r,t)}}),wh=Jr({prefix:"\0",name:"identity",encode:t=>fh(t),decode:t=>hh(t)});var vh=Object.freeze({__proto__:null,identity:wh});const mh=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Eh=Object.freeze({__proto__:null,base2:mh});const Sh=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Dh=Object.freeze({__proto__:null,base8:Sh});const Oh=Or({prefix:"9",name:"base10",alphabet:"0123456789"});var xh=Object.freeze({__proto__:null,base10:Oh});const Ih=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Th=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Nh=Object.freeze({__proto__:null,base16:Ih,base16upper:Th});const Rh=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ah=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ph=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ch=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lh=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fh=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Uh=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$h=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Mh=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jh=Object.freeze({__proto__:null,base32:Rh,base32upper:Ah,base32pad:Ph,base32padupper:Ch,base32hex:Lh,base32hexupper:Fh,base32hexpad:Uh,base32hexpadupper:$h,base32z:Mh});const Bh=Or({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),qh=Or({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zh=Object.freeze({__proto__:null,base36:Bh,base36upper:qh});const Kh=Or({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hh=Or({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Vh=Object.freeze({__proto__:null,base58btc:Kh,base58flickr:Hh});const Gh=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wh=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),kh=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yh=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Xh=Object.freeze({__proto__:null,base64:Gh,base64pad:Wh,base64url:kh,base64urlpad:Yh});const Ks=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Jh=Ks.reduce((t,e,r)=>(t[r]=e,t),[]),Qh=Ks.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Zh(t){return t.reduce((e,r)=>(e+=Jh[r],e),"")}function ef(t){const e=[];for(const r of t){const i=Qh[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const tf=Jr({prefix:"\u{1F680}",name:"base256emoji",encode:Zh,decode:ef});var rf=Object.freeze({__proto__:null,base256emoji:tf}),nf=Vs,Hs=128,sf=127,of=~sf,af=Math.pow(2,31);function Vs(t,e,r){e=e||[],r=r||0;for(var i=r;t>=af;)e[r++]=t&255|Hs,t/=128;for(;t&of;)e[r++]=t&255|Hs,t>>>=7;return e[r]=t|0,Vs.bytes=r-i+1,e}var cf=Xi,uf=128,Gs=127;function Xi(t,i){var r=0,i=i||0,n=0,s=i,a,c=t.length;do{if(s>=c)throw Xi.bytes=0,new RangeError("Could not decode varint");a=t[s++],r+=n<28?(a&Gs)<<n:(a&Gs)*Math.pow(2,n),n+=7}while(a>=uf);return Xi.bytes=s-i,r}var lf=Math.pow(2,7),hf=Math.pow(2,14),ff=Math.pow(2,21),df=Math.pow(2,28),pf=Math.pow(2,35),gf=Math.pow(2,42),yf=Math.pow(2,49),_f=Math.pow(2,56),bf=Math.pow(2,63),wf=function(t){return t<lf?1:t<hf?2:t<ff?3:t<df?4:t<pf?5:t<gf?6:t<yf?7:t<_f?8:t<bf?9:10},vf={encode:nf,decode:cf,encodingLength:wf},Ws=vf;const ks=(t,e,r=0)=>(Ws.encode(t,e,r),e),Ys=t=>Ws.encodingLength(t),Ji=(t,e)=>{const r=e.byteLength,i=Ys(t),n=i+Ys(r),s=new Uint8Array(n+r);return ks(t,s,0),ks(r,s,i),s.set(e,n),new mf(t,r,e,s)};class mf{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Xs=({name:t,code:e,encode:r})=>new Ef(t,e,r);class Ef{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ji(this.code,r):r.then(i=>Ji(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Js=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Sf=Xs({name:"sha2-256",code:18,encode:Js("SHA-256")}),Df=Xs({name:"sha2-512",code:19,encode:Js("SHA-512")});var Of=Object.freeze({__proto__:null,sha256:Sf,sha512:Df});const Qs=0,xf="identity",Zs=qs;var If=Object.freeze({__proto__:null,identity:{code:Qs,name:xf,encode:Zs,digest:t=>Ji(Qs,Zs(t))}});new TextEncoder,new TextDecoder;const eo={...vh,...Eh,...Dh,...xh,...Nh,...jh,...zh,...Vh,...Xh,...rf};({...Of,...If});function to(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ro=to("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Qi=to("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Bs(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),io={utf8:ro,"utf-8":ro,hex:eo.base16,latin1:Qi,ascii:Qi,binary:Qi,...eo};function at(t,e="utf8"){const r=io[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ft(t,e="utf8"){const r=io[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ki(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Qr(t){return at(ft(zi(t),eh),Ms)}function no(t){const e=ft(oh,js),r=sh+at(Yi([e,t]),js);return[ih,nh,r].join(rh)}function Tf(t){return at(t,Ms)}function Nf(t){return ft([Qr(t.header),Qr(t.payload)].join($s),th)}function Rf(t){return[Qr(t.header),Qr(t.payload),Tf(t.signature)].join($s)}function so(t=sr.randomBytes(ah)){return Ki.generateKeyPairFromSeed(t)}async function Af(t,e,r,i,n=Q.fromMiliseconds(Date.now())){const s={alg:Ql,typ:Zl},a=no(i.publicKey),c=n+r,h={iss:a,sub:t,aud:e,iat:n,exp:c},l=Nf({header:s,payload:h}),p=Ki.sign(i.secretKey,l);return Rf({header:s,payload:h,signature:p})}var Zi={},Zr={};Object.defineProperty(Zr,"__esModule",{value:!0});var nt=ie,en=pt,Pf=20;function Cf(t,e,r){for(var i=1634760805,n=857760878,s=2036477234,a=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],l=r[11]<<24|r[10]<<16|r[9]<<8|r[8],p=r[15]<<24|r[14]<<16|r[13]<<8|r[12],m=r[19]<<24|r[18]<<16|r[17]<<8|r[16],y=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],S=r[31]<<24|r[30]<<16|r[29]<<8|r[28],A=e[3]<<24|e[2]<<16|e[1]<<8|e[0],P=e[7]<<24|e[6]<<16|e[5]<<8|e[4],z=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],I=i,_=n,w=s,d=a,o=c,f=h,C=l,L=p,K=m,G=y,J=v,x=S,R=A,W=P,j=z,U=E,M=0;M<Pf;M+=2)I=I+o|0,R^=I,R=R>>>32-16|R<<16,K=K+R|0,o^=K,o=o>>>32-12|o<<12,_=_+f|0,W^=_,W=W>>>32-16|W<<16,G=G+W|0,f^=G,f=f>>>32-12|f<<12,w=w+C|0,j^=w,j=j>>>32-16|j<<16,J=J+j|0,C^=J,C=C>>>32-12|C<<12,d=d+L|0,U^=d,U=U>>>32-16|U<<16,x=x+U|0,L^=x,L=L>>>32-12|L<<12,w=w+C|0,j^=w,j=j>>>32-8|j<<8,J=J+j|0,C^=J,C=C>>>32-7|C<<7,d=d+L|0,U^=d,U=U>>>32-8|U<<8,x=x+U|0,L^=x,L=L>>>32-7|L<<7,_=_+f|0,W^=_,W=W>>>32-8|W<<8,G=G+W|0,f^=G,f=f>>>32-7|f<<7,I=I+o|0,R^=I,R=R>>>32-8|R<<8,K=K+R|0,o^=K,o=o>>>32-7|o<<7,I=I+f|0,U^=I,U=U>>>32-16|U<<16,J=J+U|0,f^=J,f=f>>>32-12|f<<12,_=_+C|0,R^=_,R=R>>>32-16|R<<16,x=x+R|0,C^=x,C=C>>>32-12|C<<12,w=w+L|0,W^=w,W=W>>>32-16|W<<16,K=K+W|0,L^=K,L=L>>>32-12|L<<12,d=d+o|0,j^=d,j=j>>>32-16|j<<16,G=G+j|0,o^=G,o=o>>>32-12|o<<12,w=w+L|0,W^=w,W=W>>>32-8|W<<8,K=K+W|0,L^=K,L=L>>>32-7|L<<7,d=d+o|0,j^=d,j=j>>>32-8|j<<8,G=G+j|0,o^=G,o=o>>>32-7|o<<7,_=_+C|0,R^=_,R=R>>>32-8|R<<8,x=x+R|0,C^=x,C=C>>>32-7|C<<7,I=I+f|0,U^=I,U=U>>>32-8|U<<8,J=J+U|0,f^=J,f=f>>>32-7|f<<7;nt.writeUint32LE(I+i|0,t,0),nt.writeUint32LE(_+n|0,t,4),nt.writeUint32LE(w+s|0,t,8),nt.writeUint32LE(d+a|0,t,12),nt.writeUint32LE(o+c|0,t,16),nt.writeUint32LE(f+h|0,t,20),nt.writeUint32LE(C+l|0,t,24),nt.writeUint32LE(L+p|0,t,28),nt.writeUint32LE(K+m|0,t,32),nt.writeUint32LE(G+y|0,t,36),nt.writeUint32LE(J+v|0,t,40),nt.writeUint32LE(x+S|0,t,44),nt.writeUint32LE(R+A|0,t,48),nt.writeUint32LE(W+P|0,t,52),nt.writeUint32LE(j+z|0,t,56),nt.writeUint32LE(U+E|0,t,60)}function oo(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,a;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),a=s.length-e.length,s.set(e,a)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,a=n}for(var c=new Uint8Array(64),h=0;h<r.length;h+=64){Cf(c,s,t);for(var l=h;l<h+64&&l<r.length;l++)i[l]=r[l]^c[l-h];Ff(s,0,a)}return en.wipe(c),n===0&&en.wipe(s),i}Zr.streamXOR=oo;function Lf(t,e,r,i){return i===void 0&&(i=0),en.wipe(r),oo(t,e,r,r,i)}Zr.stream=Lf;function Ff(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ao={},Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});function Uf(t,e,r){return~(t-1)&e|t-1&r}Lt.select=Uf;function $f(t,e){return(t|0)-(e|0)-1>>>31&1}Lt.lessOrEqual=$f;function co(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Lt.compare=co;function Mf(t,e){return t.length===0||e.length===0?!1:co(t,e)!==0}Lt.equal=Mf,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Lt,r=pt;t.DIGEST_LENGTH=16;var i=function(){function a(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var l=c[2]|c[3]<<8;this._r[1]=(h>>>13|l<<3)&8191;var p=c[4]|c[5]<<8;this._r[2]=(l>>>10|p<<6)&7939;var m=c[6]|c[7]<<8;this._r[3]=(p>>>7|m<<9)&8191;var y=c[8]|c[9]<<8;this._r[4]=(m>>>4|y<<12)&255,this._r[5]=y>>>1&8190;var v=c[10]|c[11]<<8;this._r[6]=(y>>>14|v<<2)&8191;var S=c[12]|c[13]<<8;this._r[7]=(v>>>11|S<<5)&8065;var A=c[14]|c[15]<<8;this._r[8]=(S>>>8|A<<8)&8191,this._r[9]=A>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return a.prototype._blocks=function(c,h,l){for(var p=this._fin?0:2048,m=this._h[0],y=this._h[1],v=this._h[2],S=this._h[3],A=this._h[4],P=this._h[5],z=this._h[6],E=this._h[7],I=this._h[8],_=this._h[9],w=this._r[0],d=this._r[1],o=this._r[2],f=this._r[3],C=this._r[4],L=this._r[5],K=this._r[6],G=this._r[7],J=this._r[8],x=this._r[9];l>=16;){var R=c[h+0]|c[h+1]<<8;m+=R&8191;var W=c[h+2]|c[h+3]<<8;y+=(R>>>13|W<<3)&8191;var j=c[h+4]|c[h+5]<<8;v+=(W>>>10|j<<6)&8191;var U=c[h+6]|c[h+7]<<8;S+=(j>>>7|U<<9)&8191;var M=c[h+8]|c[h+9]<<8;A+=(U>>>4|M<<12)&8191,P+=M>>>1&8191;var F=c[h+10]|c[h+11]<<8;z+=(M>>>14|F<<2)&8191;var B=c[h+12]|c[h+13]<<8;E+=(F>>>11|B<<5)&8191;var te=c[h+14]|c[h+15]<<8;I+=(B>>>8|te<<8)&8191,_+=te>>>5|p;var q=0,Z=q;Z+=m*w,Z+=y*(5*x),Z+=v*(5*J),Z+=S*(5*G),Z+=A*(5*K),q=Z>>>13,Z&=8191,Z+=P*(5*L),Z+=z*(5*C),Z+=E*(5*f),Z+=I*(5*o),Z+=_*(5*d),q+=Z>>>13,Z&=8191;var Y=q;Y+=m*d,Y+=y*w,Y+=v*(5*x),Y+=S*(5*J),Y+=A*(5*G),q=Y>>>13,Y&=8191,Y+=P*(5*K),Y+=z*(5*L),Y+=E*(5*C),Y+=I*(5*f),Y+=_*(5*o),q+=Y>>>13,Y&=8191;var ee=q;ee+=m*o,ee+=y*d,ee+=v*w,ee+=S*(5*x),ee+=A*(5*J),q=ee>>>13,ee&=8191,ee+=P*(5*G),ee+=z*(5*K),ee+=E*(5*L),ee+=I*(5*C),ee+=_*(5*f),q+=ee>>>13,ee&=8191;var N=q;N+=m*f,N+=y*o,N+=v*d,N+=S*w,N+=A*(5*x),q=N>>>13,N&=8191,N+=P*(5*J),N+=z*(5*G),N+=E*(5*K),N+=I*(5*L),N+=_*(5*C),q+=N>>>13,N&=8191;var T=q;T+=m*C,T+=y*f,T+=v*o,T+=S*d,T+=A*w,q=T>>>13,T&=8191,T+=P*(5*x),T+=z*(5*J),T+=E*(5*G),T+=I*(5*K),T+=_*(5*L),q+=T>>>13,T&=8191;var D=q;D+=m*L,D+=y*C,D+=v*f,D+=S*o,D+=A*d,q=D>>>13,D&=8191,D+=P*w,D+=z*(5*x),D+=E*(5*J),D+=I*(5*G),D+=_*(5*K),q+=D>>>13,D&=8191;var u=q;u+=m*K,u+=y*L,u+=v*C,u+=S*f,u+=A*o,q=u>>>13,u&=8191,u+=P*d,u+=z*w,u+=E*(5*x),u+=I*(5*J),u+=_*(5*G),q+=u>>>13,u&=8191;var b=q;b+=m*G,b+=y*K,b+=v*L,b+=S*C,b+=A*f,q=b>>>13,b&=8191,b+=P*o,b+=z*d,b+=E*w,b+=I*(5*x),b+=_*(5*J),q+=b>>>13,b&=8191;var H=q;H+=m*J,H+=y*G,H+=v*K,H+=S*L,H+=A*C,q=H>>>13,H&=8191,H+=P*f,H+=z*o,H+=E*d,H+=I*w,H+=_*(5*x),q+=H>>>13,H&=8191;var k=q;k+=m*x,k+=y*J,k+=v*G,k+=S*K,k+=A*L,q=k>>>13,k&=8191,k+=P*C,k+=z*f,k+=E*o,k+=I*d,k+=_*w,q+=k>>>13,k&=8191,q=(q<<2)+q|0,q=q+Z|0,Z=q&8191,q=q>>>13,Y+=q,m=Z,y=Y,v=ee,S=N,A=T,P=D,z=u,E=b,I=H,_=k,h+=16,l-=16}this._h[0]=m,this._h[1]=y,this._h[2]=v,this._h[3]=S,this._h[4]=A,this._h[5]=P,this._h[6]=z,this._h[7]=E,this._h[8]=I,this._h[9]=_},a.prototype.finish=function(c,h){h===void 0&&(h=0);var l=new Uint16Array(10),p,m,y,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(p=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=p,p=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=p*5,p=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=p,p=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=p,l[0]=this._h[0]+5,p=l[0]>>>13,l[0]&=8191,v=1;v<10;v++)l[v]=this._h[v]+p,p=l[v]>>>13,l[v]&=8191;for(l[9]-=8192,m=(p^1)-1,v=0;v<10;v++)l[v]&=m;for(m=~m,v=0;v<10;v++)this._h[v]=this._h[v]&m|l[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,y=this._h[0]+this._pad[0],this._h[0]=y&65535,v=1;v<8;v++)y=(this._h[v]+this._pad[v]|0)+(y>>>16)|0,this._h[v]=y&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},a.prototype.update=function(c){var h=0,l=c.length,p;if(this._leftover){p=16-this._leftover,p>l&&(p=l);for(var m=0;m<p;m++)this._buffer[this._leftover+m]=c[h+m];if(l-=p,h+=p,this._leftover+=p,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(l>=16&&(p=l-l%16,this._blocks(c,h,p),h+=p,l-=p),l){for(var m=0;m<l;m++)this._buffer[this._leftover+m]=c[h+m];this._leftover+=l}return this},a.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},a.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},a}();t.Poly1305=i;function n(a,c){var h=new i(a);h.update(c);var l=h.digest();return h.clean(),l}t.oneTimeAuth=n;function s(a,c){return a.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(a,c)}t.equal=s}(ao),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Zr,r=ao,i=pt,n=ie,s=Lt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var a=new Uint8Array(16),c=function(){function h(l){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,l.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(l)}return h.prototype.seal=function(l,p,m,y){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(l,v.length-l.length);var S=new Uint8Array(32);e.stream(this._key,v,S,4);var A=p.length+this.tagLength,P;if(y){if(y.length!==A)throw new Error("ChaCha20Poly1305: incorrect destination length");P=y}else P=new Uint8Array(A);return e.streamXOR(this._key,v,p,P,4),this._authenticate(P.subarray(P.length-this.tagLength,P.length),S,P.subarray(0,P.length-this.tagLength),m),i.wipe(v),P},h.prototype.open=function(l,p,m,y){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(p.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(l,v.length-l.length);var S=new Uint8Array(32);e.stream(this._key,v,S,4);var A=new Uint8Array(this.tagLength);if(this._authenticate(A,S,p.subarray(0,p.length-this.tagLength),m),!s.equal(A,p.subarray(p.length-this.tagLength,p.length)))return null;var P=p.length-this.tagLength,z;if(y){if(y.length!==P)throw new Error("ChaCha20Poly1305: incorrect destination length");z=y}else z=new Uint8Array(P);return e.streamXOR(this._key,v,p.subarray(0,p.length-this.tagLength),z,4),i.wipe(v),z},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(l,p,m,y){var v=new r.Poly1305(p);y&&(v.update(y),y.length%16>0&&v.update(a.subarray(y.length%16))),v.update(m),m.length%16>0&&v.update(a.subarray(m.length%16));var S=new Uint8Array(8);y&&n.writeUint64LE(y.length,S),v.update(S),n.writeUint64LE(m.length,S),v.update(S);for(var A=v.digest(),P=0;P<A.length;P++)l[P]=A[P];v.clean(),i.wipe(A),i.wipe(S)},h}();t.ChaCha20Poly1305=c}(Zi);var uo={},xr={},tn={};Object.defineProperty(tn,"__esModule",{value:!0});function jf(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}tn.isSerializableHash=jf,Object.defineProperty(xr,"__esModule",{value:!0});var Ot=tn,Bf=Lt,qf=pt,lo=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),Ot.isSerializableHash(this._inner)&&Ot.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),qf.wipe(i)}return t.prototype.reset=function(){if(!Ot.isSerializableHash(this._inner)||!Ot.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){Ot.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Ot.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!Ot.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!Ot.isSerializableHash(this._inner)||!Ot.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!Ot.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();xr.HMAC=lo;function zf(t,e,r){var i=new lo(t,e);i.update(r);var n=i.digest();return i.clean(),n}xr.hmac=zf,xr.equal=Bf.equal,Object.defineProperty(uo,"__esModule",{value:!0});var ho=xr,fo=pt,Kf=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var s=ho.hmac(this._hash,i,r);this._hmac=new ho.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),fo.wipe(this._buffer),fo.wipe(this._counter),this._bufpos=0},t}(),Hf=uo.HKDF=Kf,ei={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=pt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(h,l){if(l===void 0&&(l=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var p=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&l>0;)this._buffer[this._bufferLength++]=h[p++],l--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(p=s(this._temp,this._state,h,p,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=h[p++],l--;return this},c.prototype.finish=function(h){if(!this._finished){var l=this._bytesHashed,p=this._bufferLength,m=l/536870912|0,y=l<<3,v=l%64<56?64:128;this._buffer[p]=128;for(var S=p+1;S<v-8;S++)this._buffer[S]=0;e.writeUint32BE(m,this._buffer,v-8),e.writeUint32BE(y,this._buffer,v-4),s(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var S=0;S<this.digestLength/4;S++)e.writeUint32BE(this._state[S],h,S*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(c,h,l,p,m){for(;m>=64;){for(var y=h[0],v=h[1],S=h[2],A=h[3],P=h[4],z=h[5],E=h[6],I=h[7],_=0;_<16;_++){var w=p+_*4;c[_]=e.readUint32BE(l,w)}for(var _=16;_<64;_++){var d=c[_-2],o=(d>>>17|d<<32-17)^(d>>>19|d<<32-19)^d>>>10;d=c[_-15];var f=(d>>>7|d<<32-7)^(d>>>18|d<<32-18)^d>>>3;c[_]=(o+c[_-7]|0)+(f+c[_-16]|0)}for(var _=0;_<64;_++){var o=(((P>>>6|P<<26)^(P>>>11|P<<21)^(P>>>25|P<<7))+(P&z^~P&E)|0)+(I+(n[_]+c[_]|0)|0)|0,f=((y>>>2|y<<32-2)^(y>>>13|y<<32-13)^(y>>>22|y<<32-22))+(y&v^y&S^v&S)|0;I=E,E=z,z=P,P=A+o|0,A=S,S=v,v=y,y=o+f|0}h[0]+=y,h[1]+=v,h[2]+=S,h[3]+=A,h[4]+=P,h[5]+=z,h[6]+=E,h[7]+=I,p+=64,m-=64}return p}function a(c){var h=new i;h.update(c);var l=h.digest();return h.clean(),l}t.hash=a})(ei);var rn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=sr,r=pt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(_){const w=new Float64Array(16);if(_)for(let d=0;d<_.length;d++)w[d]=_[d];return w}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function a(_){let w=1;for(let d=0;d<16;d++){let o=_[d]+w+65535;w=Math.floor(o/65536),_[d]=o-w*65536}_[0]+=w-1+37*(w-1)}function c(_,w,d){const o=~(d-1);for(let f=0;f<16;f++){const C=o&(_[f]^w[f]);_[f]^=C,w[f]^=C}}function h(_,w){const d=i(),o=i();for(let f=0;f<16;f++)o[f]=w[f];a(o),a(o),a(o);for(let f=0;f<2;f++){d[0]=o[0]-65517;for(let L=1;L<15;L++)d[L]=o[L]-65535-(d[L-1]>>16&1),d[L-1]&=65535;d[15]=o[15]-32767-(d[14]>>16&1);const C=d[15]>>16&1;d[14]&=65535,c(o,d,1-C)}for(let f=0;f<16;f++)_[2*f]=o[f]&255,_[2*f+1]=o[f]>>8}function l(_,w){for(let d=0;d<16;d++)_[d]=w[2*d]+(w[2*d+1]<<8);_[15]&=32767}function p(_,w,d){for(let o=0;o<16;o++)_[o]=w[o]+d[o]}function m(_,w,d){for(let o=0;o<16;o++)_[o]=w[o]-d[o]}function y(_,w,d){let o,f,C=0,L=0,K=0,G=0,J=0,x=0,R=0,W=0,j=0,U=0,M=0,F=0,B=0,te=0,q=0,Z=0,Y=0,ee=0,N=0,T=0,D=0,u=0,b=0,H=0,k=0,he=0,be=0,de=0,me=0,Ue=0,Pe=0,ye=d[0],pe=d[1],fe=d[2],ue=d[3],ce=d[4],ae=d[5],oe=d[6],re=d[7],le=d[8],ge=d[9],ne=d[10],we=d[11],ve=d[12],Se=d[13],De=d[14],Ee=d[15];o=w[0],C+=o*ye,L+=o*pe,K+=o*fe,G+=o*ue,J+=o*ce,x+=o*ae,R+=o*oe,W+=o*re,j+=o*le,U+=o*ge,M+=o*ne,F+=o*we,B+=o*ve,te+=o*Se,q+=o*De,Z+=o*Ee,o=w[1],L+=o*ye,K+=o*pe,G+=o*fe,J+=o*ue,x+=o*ce,R+=o*ae,W+=o*oe,j+=o*re,U+=o*le,M+=o*ge,F+=o*ne,B+=o*we,te+=o*ve,q+=o*Se,Z+=o*De,Y+=o*Ee,o=w[2],K+=o*ye,G+=o*pe,J+=o*fe,x+=o*ue,R+=o*ce,W+=o*ae,j+=o*oe,U+=o*re,M+=o*le,F+=o*ge,B+=o*ne,te+=o*we,q+=o*ve,Z+=o*Se,Y+=o*De,ee+=o*Ee,o=w[3],G+=o*ye,J+=o*pe,x+=o*fe,R+=o*ue,W+=o*ce,j+=o*ae,U+=o*oe,M+=o*re,F+=o*le,B+=o*ge,te+=o*ne,q+=o*we,Z+=o*ve,Y+=o*Se,ee+=o*De,N+=o*Ee,o=w[4],J+=o*ye,x+=o*pe,R+=o*fe,W+=o*ue,j+=o*ce,U+=o*ae,M+=o*oe,F+=o*re,B+=o*le,te+=o*ge,q+=o*ne,Z+=o*we,Y+=o*ve,ee+=o*Se,N+=o*De,T+=o*Ee,o=w[5],x+=o*ye,R+=o*pe,W+=o*fe,j+=o*ue,U+=o*ce,M+=o*ae,F+=o*oe,B+=o*re,te+=o*le,q+=o*ge,Z+=o*ne,Y+=o*we,ee+=o*ve,N+=o*Se,T+=o*De,D+=o*Ee,o=w[6],R+=o*ye,W+=o*pe,j+=o*fe,U+=o*ue,M+=o*ce,F+=o*ae,B+=o*oe,te+=o*re,q+=o*le,Z+=o*ge,Y+=o*ne,ee+=o*we,N+=o*ve,T+=o*Se,D+=o*De,u+=o*Ee,o=w[7],W+=o*ye,j+=o*pe,U+=o*fe,M+=o*ue,F+=o*ce,B+=o*ae,te+=o*oe,q+=o*re,Z+=o*le,Y+=o*ge,ee+=o*ne,N+=o*we,T+=o*ve,D+=o*Se,u+=o*De,b+=o*Ee,o=w[8],j+=o*ye,U+=o*pe,M+=o*fe,F+=o*ue,B+=o*ce,te+=o*ae,q+=o*oe,Z+=o*re,Y+=o*le,ee+=o*ge,N+=o*ne,T+=o*we,D+=o*ve,u+=o*Se,b+=o*De,H+=o*Ee,o=w[9],U+=o*ye,M+=o*pe,F+=o*fe,B+=o*ue,te+=o*ce,q+=o*ae,Z+=o*oe,Y+=o*re,ee+=o*le,N+=o*ge,T+=o*ne,D+=o*we,u+=o*ve,b+=o*Se,H+=o*De,k+=o*Ee,o=w[10],M+=o*ye,F+=o*pe,B+=o*fe,te+=o*ue,q+=o*ce,Z+=o*ae,Y+=o*oe,ee+=o*re,N+=o*le,T+=o*ge,D+=o*ne,u+=o*we,b+=o*ve,H+=o*Se,k+=o*De,he+=o*Ee,o=w[11],F+=o*ye,B+=o*pe,te+=o*fe,q+=o*ue,Z+=o*ce,Y+=o*ae,ee+=o*oe,N+=o*re,T+=o*le,D+=o*ge,u+=o*ne,b+=o*we,H+=o*ve,k+=o*Se,he+=o*De,be+=o*Ee,o=w[12],B+=o*ye,te+=o*pe,q+=o*fe,Z+=o*ue,Y+=o*ce,ee+=o*ae,N+=o*oe,T+=o*re,D+=o*le,u+=o*ge,b+=o*ne,H+=o*we,k+=o*ve,he+=o*Se,be+=o*De,de+=o*Ee,o=w[13],te+=o*ye,q+=o*pe,Z+=o*fe,Y+=o*ue,ee+=o*ce,N+=o*ae,T+=o*oe,D+=o*re,u+=o*le,b+=o*ge,H+=o*ne,k+=o*we,he+=o*ve,be+=o*Se,de+=o*De,me+=o*Ee,o=w[14],q+=o*ye,Z+=o*pe,Y+=o*fe,ee+=o*ue,N+=o*ce,T+=o*ae,D+=o*oe,u+=o*re,b+=o*le,H+=o*ge,k+=o*ne,he+=o*we,be+=o*ve,de+=o*Se,me+=o*De,Ue+=o*Ee,o=w[15],Z+=o*ye,Y+=o*pe,ee+=o*fe,N+=o*ue,T+=o*ce,D+=o*ae,u+=o*oe,b+=o*re,H+=o*le,k+=o*ge,he+=o*ne,be+=o*we,de+=o*ve,me+=o*Se,Ue+=o*De,Pe+=o*Ee,C+=38*Y,L+=38*ee,K+=38*N,G+=38*T,J+=38*D,x+=38*u,R+=38*b,W+=38*H,j+=38*k,U+=38*he,M+=38*be,F+=38*de,B+=38*me,te+=38*Ue,q+=38*Pe,f=1,o=C+f+65535,f=Math.floor(o/65536),C=o-f*65536,o=L+f+65535,f=Math.floor(o/65536),L=o-f*65536,o=K+f+65535,f=Math.floor(o/65536),K=o-f*65536,o=G+f+65535,f=Math.floor(o/65536),G=o-f*65536,o=J+f+65535,f=Math.floor(o/65536),J=o-f*65536,o=x+f+65535,f=Math.floor(o/65536),x=o-f*65536,o=R+f+65535,f=Math.floor(o/65536),R=o-f*65536,o=W+f+65535,f=Math.floor(o/65536),W=o-f*65536,o=j+f+65535,f=Math.floor(o/65536),j=o-f*65536,o=U+f+65535,f=Math.floor(o/65536),U=o-f*65536,o=M+f+65535,f=Math.floor(o/65536),M=o-f*65536,o=F+f+65535,f=Math.floor(o/65536),F=o-f*65536,o=B+f+65535,f=Math.floor(o/65536),B=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=q+f+65535,f=Math.floor(o/65536),q=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,C+=f-1+37*(f-1),f=1,o=C+f+65535,f=Math.floor(o/65536),C=o-f*65536,o=L+f+65535,f=Math.floor(o/65536),L=o-f*65536,o=K+f+65535,f=Math.floor(o/65536),K=o-f*65536,o=G+f+65535,f=Math.floor(o/65536),G=o-f*65536,o=J+f+65535,f=Math.floor(o/65536),J=o-f*65536,o=x+f+65535,f=Math.floor(o/65536),x=o-f*65536,o=R+f+65535,f=Math.floor(o/65536),R=o-f*65536,o=W+f+65535,f=Math.floor(o/65536),W=o-f*65536,o=j+f+65535,f=Math.floor(o/65536),j=o-f*65536,o=U+f+65535,f=Math.floor(o/65536),U=o-f*65536,o=M+f+65535,f=Math.floor(o/65536),M=o-f*65536,o=F+f+65535,f=Math.floor(o/65536),F=o-f*65536,o=B+f+65535,f=Math.floor(o/65536),B=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=q+f+65535,f=Math.floor(o/65536),q=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,C+=f-1+37*(f-1),_[0]=C,_[1]=L,_[2]=K,_[3]=G,_[4]=J,_[5]=x,_[6]=R,_[7]=W,_[8]=j,_[9]=U,_[10]=M,_[11]=F,_[12]=B,_[13]=te,_[14]=q,_[15]=Z}function v(_,w){y(_,w,w)}function S(_,w){const d=i();for(let o=0;o<16;o++)d[o]=w[o];for(let o=253;o>=0;o--)v(d,d),o!==2&&o!==4&&y(d,d,w);for(let o=0;o<16;o++)_[o]=d[o]}function A(_,w){const d=new Uint8Array(32),o=new Float64Array(80),f=i(),C=i(),L=i(),K=i(),G=i(),J=i();for(let j=0;j<31;j++)d[j]=_[j];d[31]=_[31]&127|64,d[0]&=248,l(o,w);for(let j=0;j<16;j++)C[j]=o[j];f[0]=K[0]=1;for(let j=254;j>=0;--j){const U=d[j>>>3]>>>(j&7)&1;c(f,C,U),c(L,K,U),p(G,f,L),m(f,f,L),p(L,C,K),m(C,C,K),v(K,G),v(J,f),y(f,L,f),y(L,C,G),p(G,f,L),m(f,f,L),v(C,f),m(L,K,J),y(f,L,s),p(f,f,K),y(L,L,f),y(f,K,J),y(K,C,o),v(C,G),c(f,C,U),c(L,K,U)}for(let j=0;j<16;j++)o[j+16]=f[j],o[j+32]=L[j],o[j+48]=C[j],o[j+64]=K[j];const x=o.subarray(32),R=o.subarray(16);S(x,x),y(R,R,x);const W=new Uint8Array(32);return h(W,R),W}t.scalarMult=A;function P(_){return A(_,n)}t.scalarMultBase=P;function z(_){if(_.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const w=new Uint8Array(_);return{publicKey:P(w),secretKey:w}}t.generateKeyPairFromSeed=z;function E(_){const w=(0,e.randomBytes)(32,_),d=z(w);return(0,r.wipe)(w),d}t.generateKeyPair=E;function I(_,w,d=!1){if(_.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(w.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=A(_,w);if(d){let f=0;for(let C=0;C<o.length;C++)f|=o[C];if(f===0)throw new Error("X25519: invalid shared key")}return o}t.sharedKey=I})(rn);var po=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},Vf=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Gf=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Wf=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),kf=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Yf=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Xf=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Jf=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,go=3,Qf=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Xf]],yo=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Zf(t){return t?_o(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Yf:typeof navigator<"u"?_o(navigator.userAgent):rd()}function ed(t){return t!==""&&Qf.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function _o(t){var e=ed(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new kf;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<go&&(n=po(po([],n,!0),id(go-n.length),!0)):n=[];var s=n.join("."),a=td(t),c=Jf.exec(t);return c&&c[1]?new Wf(r,s,a,c[1]):new Vf(r,s,a)}function td(t){for(var e=0,r=yo.length;e<r;e++){var i=yo[e],n=i[0],s=i[1],a=s.exec(t);if(a)return n}return null}function rd(){var t=typeof process<"u"&&process.version;return t?new Gf(process.version.slice(1)):null}function id(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=wo=Ie.getLocation=Ie.getLocationOrThrow=nn=Ie.getNavigator=Ie.getNavigatorOrThrow=bo=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function kt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Ie.getFromWindow=kt;function or(t){const e=kt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Ie.getFromWindowOrThrow=or;function nd(){return or("document")}Ie.getDocumentOrThrow=nd;function sd(){return kt("document")}var bo=Ie.getDocument=sd;function od(){return or("navigator")}Ie.getNavigatorOrThrow=od;function ad(){return kt("navigator")}var nn=Ie.getNavigator=ad;function cd(){return or("location")}Ie.getLocationOrThrow=cd;function ud(){return kt("location")}var wo=Ie.getLocation=ud;function ld(){return or("crypto")}Ie.getCryptoOrThrow=ld;function hd(){return kt("crypto")}Ie.getCrypto=hd;function fd(){return or("localStorage")}Ie.getLocalStorageOrThrow=fd;function dd(){return kt("localStorage")}Ie.getLocalStorage=dd;var sn={};Object.defineProperty(sn,"__esModule",{value:!0});var vo=sn.getWindowMetadata=void 0;const mo=Ie;function pd(){let t,e;try{t=mo.getDocumentOrThrow(),e=mo.getLocationOrThrow()}catch{return null}function r(){const m=t.getElementsByTagName("link"),y=[];for(let v=0;v<m.length;v++){const S=m[v],A=S.getAttribute("rel");if(A&&A.toLowerCase().indexOf("icon")>-1){const P=S.getAttribute("href");if(P)if(P.toLowerCase().indexOf("https:")===-1&&P.toLowerCase().indexOf("http:")===-1&&P.indexOf("//")!==0){let z=e.protocol+"//"+e.host;if(P.indexOf("/")===0)z+=P;else{const E=e.pathname.split("/");E.pop();const I=E.join("/");z+=I+"/"+P}y.push(z)}else if(P.indexOf("//")===0){const z=e.protocol+P;y.push(z)}else y.push(P)}}return y}function i(...m){const y=t.getElementsByTagName("meta");for(let v=0;v<y.length;v++){const S=y[v],A=["itemprop","property","name"].map(P=>S.getAttribute(P)).filter(P=>P?m.includes(P):!1);if(A.length&&A){const P=S.getAttribute("content");if(P)return P}}return""}function n(){let m=i("name","og:site_name","og:title","twitter:title");return m||(m=t.title),m}function s(){return i("description","og:description","twitter:description","keywords")}const a=n(),c=s(),h=e.origin,l=r();return{description:c,url:h,icons:l,name:a}}vo=sn.getWindowMetadata=pd;var Ir={},gd=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Eo="%[a-f0-9]{2}",So=new RegExp("("+Eo+")|([^%]+?)","gi"),Do=new RegExp("("+Eo+")+","gi");function on(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],on(r),on(i))}function yd(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(So)||[],r=1;r<e.length;r++)t=on(e,r).join(""),e=t.match(So)||[];return t}}function _d(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=Do.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=yd(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Do.exec(t)}e["%C2"]="\uFFFD";for(var n=Object.keys(e),s=0;s<n.length;s++){var a=n[s];t=t.replace(new RegExp(a,"g"),e[a])}return t}var bd=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return _d(t)}},wd=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},vd=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),s=0;s<i.length;s++){var a=i[s],c=t[a];(n?e.indexOf(a)!==-1:e(a,c,t))&&(r[a]=c)}return r};(function(t){const e=gd,r=bd,i=wd,n=vd,s=E=>E==null,a=Symbol("encodeFragmentIdentifier");function c(E){switch(E.arrayFormat){case"index":return I=>(_,w)=>{const d=_.length;return w===void 0||E.skipNull&&w===null||E.skipEmptyString&&w===""?_:w===null?[..._,[p(I,E),"[",d,"]"].join("")]:[..._,[p(I,E),"[",p(d,E),"]=",p(w,E)].join("")]};case"bracket":return I=>(_,w)=>w===void 0||E.skipNull&&w===null||E.skipEmptyString&&w===""?_:w===null?[..._,[p(I,E),"[]"].join("")]:[..._,[p(I,E),"[]=",p(w,E)].join("")];case"colon-list-separator":return I=>(_,w)=>w===void 0||E.skipNull&&w===null||E.skipEmptyString&&w===""?_:w===null?[..._,[p(I,E),":list="].join("")]:[..._,[p(I,E),":list=",p(w,E)].join("")];case"comma":case"separator":case"bracket-separator":{const I=E.arrayFormat==="bracket-separator"?"[]=":"=";return _=>(w,d)=>d===void 0||E.skipNull&&d===null||E.skipEmptyString&&d===""?w:(d=d===null?"":d,w.length===0?[[p(_,E),I,p(d,E)].join("")]:[[w,p(d,E)].join(E.arrayFormatSeparator)])}default:return I=>(_,w)=>w===void 0||E.skipNull&&w===null||E.skipEmptyString&&w===""?_:w===null?[..._,p(I,E)]:[..._,[p(I,E),"=",p(w,E)].join("")]}}function h(E){let I;switch(E.arrayFormat){case"index":return(_,w,d)=>{if(I=/\[(\d*)\]$/.exec(_),_=_.replace(/\[\d*\]$/,""),!I){d[_]=w;return}d[_]===void 0&&(d[_]={}),d[_][I[1]]=w};case"bracket":return(_,w,d)=>{if(I=/(\[\])$/.exec(_),_=_.replace(/\[\]$/,""),!I){d[_]=w;return}if(d[_]===void 0){d[_]=[w];return}d[_]=[].concat(d[_],w)};case"colon-list-separator":return(_,w,d)=>{if(I=/(:list)$/.exec(_),_=_.replace(/:list$/,""),!I){d[_]=w;return}if(d[_]===void 0){d[_]=[w];return}d[_]=[].concat(d[_],w)};case"comma":case"separator":return(_,w,d)=>{const o=typeof w=="string"&&w.includes(E.arrayFormatSeparator),f=typeof w=="string"&&!o&&m(w,E).includes(E.arrayFormatSeparator);w=f?m(w,E):w;const C=o||f?w.split(E.arrayFormatSeparator).map(L=>m(L,E)):w===null?w:m(w,E);d[_]=C};case"bracket-separator":return(_,w,d)=>{const o=/(\[\])$/.test(_);if(_=_.replace(/\[\]$/,""),!o){d[_]=w&&m(w,E);return}const f=w===null?[]:w.split(E.arrayFormatSeparator).map(C=>m(C,E));if(d[_]===void 0){d[_]=f;return}d[_]=[].concat(d[_],f)};default:return(_,w,d)=>{if(d[_]===void 0){d[_]=w;return}d[_]=[].concat(d[_],w)}}}function l(E){if(typeof E!="string"||E.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function p(E,I){return I.encode?I.strict?e(E):encodeURIComponent(E):E}function m(E,I){return I.decode?r(E):E}function y(E){return Array.isArray(E)?E.sort():typeof E=="object"?y(Object.keys(E)).sort((I,_)=>Number(I)-Number(_)).map(I=>E[I]):E}function v(E){const I=E.indexOf("#");return I!==-1&&(E=E.slice(0,I)),E}function S(E){let I="";const _=E.indexOf("#");return _!==-1&&(I=E.slice(_)),I}function A(E){E=v(E);const I=E.indexOf("?");return I===-1?"":E.slice(I+1)}function P(E,I){return I.parseNumbers&&!Number.isNaN(Number(E))&&typeof E=="string"&&E.trim()!==""?E=Number(E):I.parseBooleans&&E!==null&&(E.toLowerCase()==="true"||E.toLowerCase()==="false")&&(E=E.toLowerCase()==="true"),E}function z(E,I){I=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},I),l(I.arrayFormatSeparator);const _=h(I),w=Object.create(null);if(typeof E!="string"||(E=E.trim().replace(/^[?#&]/,""),!E))return w;for(const d of E.split("&")){if(d==="")continue;let[o,f]=i(I.decode?d.replace(/\+/g," "):d,"=");f=f===void 0?null:["comma","separator","bracket-separator"].includes(I.arrayFormat)?f:m(f,I),_(m(o,I),f,w)}for(const d of Object.keys(w)){const o=w[d];if(typeof o=="object"&&o!==null)for(const f of Object.keys(o))o[f]=P(o[f],I);else w[d]=P(o,I)}return I.sort===!1?w:(I.sort===!0?Object.keys(w).sort():Object.keys(w).sort(I.sort)).reduce((d,o)=>{const f=w[o];return f&&typeof f=="object"&&!Array.isArray(f)?d[o]=y(f):d[o]=f,d},Object.create(null))}t.extract=A,t.parse=z,t.stringify=(E,I)=>{if(!E)return"";I=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},I),l(I.arrayFormatSeparator);const _=f=>I.skipNull&&s(E[f])||I.skipEmptyString&&E[f]==="",w=c(I),d={};for(const f of Object.keys(E))_(f)||(d[f]=E[f]);const o=Object.keys(d);return I.sort!==!1&&o.sort(I.sort),o.map(f=>{const C=E[f];return C===void 0?"":C===null?p(f,I):Array.isArray(C)?C.length===0&&I.arrayFormat==="bracket-separator"?p(f,I)+"[]":C.reduce(w(f),[]).join("&"):p(f,I)+"="+p(C,I)}).filter(f=>f.length>0).join("&")},t.parseUrl=(E,I)=>{I=Object.assign({decode:!0},I);const[_,w]=i(E,"#");return Object.assign({url:_.split("?")[0]||"",query:z(A(E),I)},I&&I.parseFragmentIdentifier&&w?{fragmentIdentifier:m(w,I)}:{})},t.stringifyUrl=(E,I)=>{I=Object.assign({encode:!0,strict:!0,[a]:!0},I);const _=v(E.url).split("?")[0]||"",w=t.extract(E.url),d=t.parse(w,{sort:!1}),o=Object.assign(d,E.query);let f=t.stringify(o,I);f&&(f=`?${f}`);let C=S(E.url);return E.fragmentIdentifier&&(C=`#${I[a]?p(E.fragmentIdentifier,I):E.fragmentIdentifier}`),`${_}${f}${C}`},t.pick=(E,I,_)=>{_=Object.assign({parseFragmentIdentifier:!0,[a]:!1},_);const{url:w,query:d,fragmentIdentifier:o}=t.parseUrl(E,_);return t.stringifyUrl({url:w,query:n(d,I),fragmentIdentifier:o},_)},t.exclude=(E,I,_)=>{const w=Array.isArray(I)?d=>!I.includes(d):(d,o)=>!I(d,o);return t.pick(E,w,_)}})(Ir);const md={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Oo(t,e){return t.includes(":")?[t]:e.chains||[]}const xo="base10",ct="base16",an="base64pad",cn="utf8",Io=0,Yt=1,Ed=0,To=1,un=12,ln=32;function Sd(){const t=rn.generateKeyPair();return{privateKey:at(t.secretKey,ct),publicKey:at(t.publicKey,ct)}}function hn(){const t=sr.randomBytes(ln);return at(t,ct)}function Dd(t,e){const r=rn.sharedKey(ft(t,ct),ft(e,ct)),i=new Hf(ei.SHA256,r).expand(ln);return at(i,ct)}function Od(t){const e=ei.hash(ft(t,ct));return at(e,ct)}function ar(t){const e=ei.hash(ft(t,cn));return at(e,ct)}function xd(t){return ft(`${t}`,xo)}function Tr(t){return Number(at(t,xo))}function Id(t){const e=xd(typeof t.type<"u"?t.type:Io);if(Tr(e)===Yt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ft(t.senderPublicKey,ct):void 0,i=typeof t.iv<"u"?ft(t.iv,ct):sr.randomBytes(un),n=new Zi.ChaCha20Poly1305(ft(t.symKey,ct)).seal(i,ft(t.message,cn));return Nd({type:e,sealed:n,iv:i,senderPublicKey:r})}function Td(t){const e=new Zi.ChaCha20Poly1305(ft(t.symKey,ct)),{sealed:r,iv:i}=ti(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return at(n,cn)}function Nd(t){if(Tr(t.type)===Yt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return at(Yi([t.type,t.senderPublicKey,t.iv,t.sealed]),an)}return at(Yi([t.type,t.iv,t.sealed]),an)}function ti(t){const e=ft(t,an),r=e.slice(Ed,To),i=To;if(Tr(r)===Yt){const c=i+ln,h=c+un,l=e.slice(i,c),p=e.slice(c,h),m=e.slice(h);return{type:r,sealed:m,iv:p,senderPublicKey:l}}const n=i+un,s=e.slice(i,n),a=e.slice(n);return{type:r,sealed:a,iv:s}}function Rd(t,e){const r=ti(t);return No({type:Tr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?at(r.senderPublicKey,ct):void 0,receiverPublicKey:e?.receiverPublicKey})}function No(t){const e=t?.type||Io;if(e===Yt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Ro(t){return t.type===Yt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Ad=Object.defineProperty,Ao=Object.getOwnPropertySymbols,Pd=Object.prototype.hasOwnProperty,Cd=Object.prototype.propertyIsEnumerable,Po=(t,e,r)=>e in t?Ad(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Co=(t,e)=>{for(var r in e||(e={}))Pd.call(e,r)&&Po(t,r,e[r]);if(Ao)for(var r of Ao(e))Cd.call(e,r)&&Po(t,r,e[r]);return t};const Ld="ReactNative",Ft={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Fd="js";function fn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Lo(){return!bo()&&!!nn()&&navigator.product===Ld}function dn(){return!fn()&&!!nn()}function pn(){return Lo()?Ft.reactNative:fn()?Ft.node:dn()?Ft.browser:Ft.unknown}function Ud(t,e){let r=Ir.parse(t);return r=Co(Co({},r),e),t=Ir.stringify(r),t}function $d(){return vo()||{name:"",description:"",url:"",icons:[""]}}function Md(){if(pn()===Ft.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Zf();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function jd(){var t;const e=pn();return e===Ft.browser?[e,((t=wo())==null?void 0:t.host)||"unknown"].join(":"):e}function Bd(t,e,r){const i=Md(),n=jd();return[[t,e].join("-"),[Fd,r].join("-"),i,n].join("/")}function qd({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a}){const c=r.split("?"),h=Bd(t,e,i),l={auth:n,ua:h,projectId:s,useOnCloseEvent:a||void 0},p=Ud(c[1]||"",l);return c[0]+"?"+p}function Xt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Fo(t){return Object.fromEntries(t.entries())}function Uo(t){return new Map(Object.entries(t))}function cr(t=Q.FIVE_MINUTES,e){const r=Q.toMiliseconds(t||Q.FIVE_MINUTES);let i,n,s;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{s=setTimeout(()=>{c(new Error(e))},r),i=a,n=c})}}function ri(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const a=await t;i(a)}catch(a){n(a)}clearTimeout(s)})}function $o(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function zd(t){return $o("topic",t)}function Kd(t){return $o("id",t)}function Mo(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function mt(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function Ut(t){return Date.now()>=Q.toMiliseconds(t)}function $e(t,e){return`${t}${e?`:${e}`:""}`}async function Hd({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let n=i?.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const s=`${n}/wc?requestId=${t}&sessionTopic=${e}`,a=pn();a===Ft.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):a===Ft.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(i){console.error(i)}}const Vd="irn";function gn(t){return t?.relay||{protocol:Vd}}function ii(t){const e=md[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Gd=Object.defineProperty,jo=Object.getOwnPropertySymbols,Wd=Object.prototype.hasOwnProperty,kd=Object.prototype.propertyIsEnumerable,Bo=(t,e,r)=>e in t?Gd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yd=(t,e)=>{for(var r in e||(e={}))Wd.call(e,r)&&Bo(t,r,e[r]);if(jo)for(var r of jo(e))kd.call(e,r)&&Bo(t,r,e[r]);return t};function Xd(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),a=t[n];r[s]=a}}),r}function Jd(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",a=Ir.parse(s);return{protocol:i,topic:Qd(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:Xd(a)}}function Qd(t){return t.startsWith("//")?t.substring(2):t}function Zd(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=r+e+n;t[n]&&(i[s]=t[n])}),i}function ep(t){return`${t.protocol}:${t.topic}@${t.version}?`+Ir.stringify(Yd({symKey:t.symKey},Zd(t.relay)))}function ur(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function tp(t){const e=[];return Object.values(t).forEach(r=>{e.push(...ur(r.accounts))}),e}function rp(t,e){const r=[];return Object.values(t).forEach(i=>{ur(i.accounts).includes(e)&&r.push(...i.methods)}),r}function ip(t,e){const r=[];return Object.values(t).forEach(i=>{ur(i.accounts).includes(e)&&r.push(...i.events)}),r}function np(t,e){const r=si(t,e);if(r)throw new Error(r.message);const i={};for(const[n,s]of Object.entries(t))i[n]={methods:s.methods,events:s.events,chains:s.accounts.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)};return i}const sp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},op={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:r,code:i}=op[t];return{message:e?`${r} ${e}`:r,code:i}}function He(t,e){const{message:r,code:i}=sp[t];return{message:e?`${r} ${e}`:r,code:i}}function Nr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Rr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ut(t){return typeof t>"u"}function Ve(t,e){return e&&ut(t)?!0:typeof t=="string"&&!!t.trim().length}function yn(t,e){return e&&ut(t)?!0:typeof t=="number"&&!isNaN(t)}function ap(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Xt(n,i)?(i.forEach(a=>{const{accounts:c,methods:h,events:l}=t.namespaces[a],p=ur(c),m=r[a];(!Xt(Oo(a,m),p)||!Xt(m.methods,h)||!Xt(m.events,l))&&(s=!1)}),s):!1}function ni(t){return Ve(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function cp(t){if(Ve(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&ni(r)}}return!1}function up(t){if(Ve(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function lp(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function hp(t){return t?.topic}function fp(t,e){let r=null;return Ve(t?.publicKey,!1)||(r=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function qo(t){let e=!0;return Nr(t)?t.length&&(e=t.every(r=>Ve(r,!1))):e=!1,e}function dp(t,e,r){let i=null;return Nr(e)&&e.length?e.forEach(n=>{i||ni(n)||(i=He("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):ni(t)||(i=He("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function pp(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const a=dp(n,Oo(n,s),`${e} ${r}`);a&&(i=a)}),i}function gp(t,e){let r=null;return Nr(t)?t.forEach(i=>{r||cp(i)||(r=He("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=He("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function yp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=gp(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function _p(t,e){let r=null;return qo(t?.methods)?qo(t?.events)||(r=He("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=He("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function zo(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=_p(i,`${e}, namespace`);n&&(r=n)}),r}function bp(t,e,r){let i=null;if(t&&Rr(t)){const n=zo(t,e);n&&(i=n);const s=pp(t,e,r);s&&(i=s)}else i=V("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function si(t,e){let r=null;if(t&&Rr(t)){const i=zo(t,e);i&&(r=i);const n=yp(t,e);n&&(r=n)}else r=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Ko(t){return Ve(t.protocol,!0)}function wp(t,e){let r=!1;return e&&!t?r=!0:t&&Nr(t)&&t.length&&t.forEach(i=>{r=Ko(i)}),r}function vp(t){return typeof t=="number"}function dt(t){return typeof t<"u"&&typeof t!==null}function mp(t){return!(!t||typeof t!="object"||!t.code||!yn(t.code,!1)||!t.message||!Ve(t.message,!1))}function Ep(t){return!(ut(t)||!Ve(t.method,!1))}function Sp(t){return!(ut(t)||ut(t.result)&&ut(t.error)||!yn(t.id,!1)||!Ve(t.jsonrpc,!1))}function Dp(t){return!(ut(t)||!Ve(t.name,!1))}function Ho(t,e){return!(!ni(e)||!tp(t).includes(e))}function Op(t,e,r){return Ve(r,!1)?rp(t,e).includes(r):!1}function xp(t,e,r){return Ve(r,!1)?ip(t,e).includes(r):!1}function Vo(t,e,r){let i=null;const n=Ip(t),s=Tp(e),a=Object.keys(n),c=Object.keys(s),h=Go(Object.keys(t)),l=Go(Object.keys(e)),p=h.filter(m=>!l.includes(m));return p.length&&(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${p.toString()}
      Received: ${Object.keys(e).toString()}`)),Xt(a,c)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(m=>{if(!m.includes(":")||i)return;const y=ur(e[m].accounts);y.includes(m)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${m}
        Required: ${m}
        Approved: ${y.toString()}`))}),a.forEach(m=>{i||(Xt(n[m].methods,s[m].methods)?Xt(n[m].events,s[m].events)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${m}`)):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${m}`))}),i}function Ip(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Go(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Tp(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=ur(t[r].accounts);i?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function Np(t,e){return yn(t,!1)&&t<=e.max&&t>=e.min}const Rp="PARSE_ERROR",Ap="INVALID_REQUEST",Pp="METHOD_NOT_FOUND",Cp="INVALID_PARAMS",Wo="INTERNAL_ERROR",_n="SERVER_ERROR",Lp=[-32700,-32600,-32601,-32602,-32603],Ar={[Rp]:{code:-32700,message:"Parse error"},[Ap]:{code:-32600,message:"Invalid Request"},[Pp]:{code:-32601,message:"Method not found"},[Cp]:{code:-32602,message:"Invalid params"},[Wo]:{code:-32603,message:"Internal error"},[_n]:{code:-32e3,message:"Server error"}},ko=_n;function Fp(t){return Lp.includes(t)}function Yo(t){return Object.keys(Ar).includes(t)?Ar[t]:Ar[ko]}function Up(t){const e=Object.values(Ar).find(r=>r.code===t);return e||Ar[ko]}function $p(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Xo={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var bn=function(t,e){return bn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},bn(t,e)};function Mp(t,e){bn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var wn=function(){return wn=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},wn.apply(this,arguments)};function jp(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Bp(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function qp(t,e){return function(r,i){e(r,i,t)}}function zp(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Kp(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(p){try{l(i.next(p))}catch(m){a(m)}}function h(p){try{l(i.throw(p))}catch(m){a(m)}}function l(p){p.done?s(p.value):n(p.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function Hp(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(p){return h([l,p])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(p){l=[6,p],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Vp(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Gp(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function vn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Jo(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Wp(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Jo(arguments[e]));return t}function kp(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Pr(t){return this instanceof Pr?(this.v=t,this):new Pr(t)}function Yp(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(v){return new Promise(function(S,A){s.push([y,v,S,A])>1||c(y,v)})})}function c(y,v){try{h(i[y](v))}catch(S){m(s[0][3],S)}}function h(y){y.value instanceof Pr?Promise.resolve(y.value.v).then(l,p):m(s[0][2],y)}function l(y){c("next",y)}function p(y){c("throw",y)}function m(y,v){y(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Xp(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Pr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function Jp(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof vn=="function"?vn(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Qp(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Zp(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function eg(t){return t&&t.__esModule?t:{default:t}}function tg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function rg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var ig=Object.freeze({__proto__:null,__extends:Mp,get __assign(){return wn},__rest:jp,__decorate:Bp,__param:qp,__metadata:zp,__awaiter:Kp,__generator:Hp,__createBinding:Vp,__exportStar:Gp,__values:vn,__read:Jo,__spread:Wp,__spreadArrays:kp,__await:Pr,__asyncGenerator:Yp,__asyncDelegator:Xp,__asyncValues:Jp,__makeTemplateObject:Qp,__importStar:Zp,__importDefault:eg,__classPrivateFieldGet:tg,__classPrivateFieldSet:rg}),ng=zt(ig),Nt={},Qo;function sg(){if(Qo)return Nt;Qo=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.isBrowserCryptoAvailable=Nt.getSubtleCrypto=Nt.getBrowerCrypto=void 0;function t(){return et?.crypto||et?.msCrypto||{}}Nt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Nt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Nt.isBrowserCryptoAvailable=r,Nt}var Rt={},Zo;function og(){if(Zo)return Rt;Zo=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.isBrowser=Rt.isNode=Rt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Rt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Rt.isNode=e;function r(){return!t()&&!e()}return Rt.isBrowser=r,Rt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ng;e.__exportStar(sg(),t),e.__exportStar(og(),t)})(Xo);function ea(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function mn(t=6){return BigInt(ea(t))}function oi(t,e,r){return{id:r||ea(),jsonrpc:"2.0",method:t,params:e}}function En(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Sn(t,e,r){return{id:t,jsonrpc:"2.0",error:ag(e,r)}}function ag(t,e){return typeof t>"u"?Yo(Wo):(typeof t=="string"&&(t=Object.assign(Object.assign({},Yo(_n)),{message:t})),typeof e<"u"&&(t.data=e),Fp(t.code)&&(t=Up(t.code)),t)}class cg{}class ug extends cg{constructor(){super()}}class lg extends ug{constructor(e){super()}}const hg="^wss?:";function fg(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function dg(t,e){const r=fg(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function ta(t){return dg(t,hg)}function pg(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function ra(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Dn(t){return ra(t)&&"method"in t}function ai(t){return ra(t)&&(At(t)||Et(t))}function At(t){return"result"in t}function Et(t){return"error"in t}class gg extends lg{constructor(e){super(e),this.events=new ht.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(oi(e.method,e.params||[],e.id||mn().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{Et(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ai(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const yg=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),_g=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ia=t=>t.split("?")[0],na=10,bg=yg();class wg{constructor(e){if(this.url=e,this.events=new ht.exports.EventEmitter,this.registering=!1,!ta(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(zi(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!ta(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=Xo.isReactNative()?void 0:{rejectUnauthorized:!pg(e)},s=new bg(e,[],n);_g()?s.onerror=a=>{const c=a;i(this.emitError(c.error))}:s.on("error",a=>{i(this.emitError(a))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Ts(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Sn(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return $p(e,ia(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>na&&this.events.setMaxListeners(na)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${ia(this.url)}`));return this.events.emit("register_error",r),r}}var On={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,s=2,a=9007199254740991,c="[object Arguments]",h="[object Array]",l="[object AsyncFunction]",p="[object Boolean]",m="[object Date]",y="[object Error]",v="[object Function]",S="[object GeneratorFunction]",A="[object Map]",P="[object Number]",z="[object Null]",E="[object Object]",I="[object Promise]",_="[object Proxy]",w="[object RegExp]",d="[object Set]",o="[object String]",f="[object Symbol]",C="[object Undefined]",L="[object WeakMap]",K="[object ArrayBuffer]",G="[object DataView]",J="[object Float32Array]",x="[object Float64Array]",R="[object Int8Array]",W="[object Int16Array]",j="[object Int32Array]",U="[object Uint8Array]",M="[object Uint8ClampedArray]",F="[object Uint16Array]",B="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,Y={};Y[J]=Y[x]=Y[R]=Y[W]=Y[j]=Y[U]=Y[M]=Y[F]=Y[B]=!0,Y[c]=Y[h]=Y[K]=Y[p]=Y[G]=Y[m]=Y[y]=Y[v]=Y[A]=Y[P]=Y[E]=Y[w]=Y[d]=Y[o]=Y[L]=!1;var ee=typeof et=="object"&&et&&et.Object===Object&&et,N=typeof self=="object"&&self&&self.Object===Object&&self,T=ee||N||Function("return this")(),D=e&&!e.nodeType&&e,u=D&&!0&&t&&!t.nodeType&&t,b=u&&u.exports===D,H=b&&ee.process,k=function(){try{return H&&H.binding&&H.binding("util")}catch{}}(),he=k&&k.isTypedArray;function be(g,O){for(var $=-1,X=g==null?0:g.length,Te=0,se=[];++$<X;){var Fe=g[$];O(Fe,$,g)&&(se[Te++]=Fe)}return se}function de(g,O){for(var $=-1,X=O.length,Te=g.length;++$<X;)g[Te+$]=O[$];return g}function me(g,O){for(var $=-1,X=g==null?0:g.length;++$<X;)if(O(g[$],$,g))return!0;return!1}function Ue(g,O){for(var $=-1,X=Array(g);++$<g;)X[$]=O($);return X}function Pe(g){return function(O){return g(O)}}function ye(g,O){return g.has(O)}function pe(g,O){return g?.[O]}function fe(g){var O=-1,$=Array(g.size);return g.forEach(function(X,Te){$[++O]=[Te,X]}),$}function ue(g,O){return function($){return g(O($))}}function ce(g){var O=-1,$=Array(g.size);return g.forEach(function(X){$[++O]=X}),$}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,le=T["__core-js_shared__"],ge=oe.toString,ne=re.hasOwnProperty,we=function(){var g=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),ve=re.toString,Se=RegExp("^"+ge.call(ne).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=b?T.Buffer:void 0,Ee=T.Symbol,St=T.Uint8Array,Tt=re.propertyIsEnumerable,Mt=ae.splice,gt=Ee?Ee.toStringTag:void 0,Jt=Object.getOwnPropertySymbols,Mr=De?De.isBuffer:void 0,pi=ue(Object.keys,Object),Me=fr(T,"DataView"),Ce=fr(T,"Map"),je=fr(T,"Promise"),Be=fr(T,"Set"),qe=fr(T,"WeakMap"),Le=fr(Object,"create"),Ge=Zt(Me),We=Zt(Ce),ke=Zt(je),Ye=Zt(Be),Xe=Zt(qe),Ke=Ee?Ee.prototype:void 0,ze=Ke?Ke.valueOf:void 0;function Ne(g){var O=-1,$=g==null?0:g.length;for(this.clear();++O<$;){var X=g[O];this.set(X[0],X[1])}}function Je(){this.__data__=Le?Le(null):{},this.size=0}function Qe(g){var O=this.has(g)&&delete this.__data__[g];return this.size-=O?1:0,O}function u_(g){var O=this.__data__;if(Le){var $=O[g];return $===i?void 0:$}return ne.call(O,g)?O[g]:void 0}function l_(g){var O=this.__data__;return Le?O[g]!==void 0:ne.call(O,g)}function h_(g,O){var $=this.__data__;return this.size+=this.has(g)?0:1,$[g]=Le&&O===void 0?i:O,this}Ne.prototype.clear=Je,Ne.prototype.delete=Qe,Ne.prototype.get=u_,Ne.prototype.has=l_,Ne.prototype.set=h_;function Pt(g){var O=-1,$=g==null?0:g.length;for(this.clear();++O<$;){var X=g[O];this.set(X[0],X[1])}}function f_(){this.__data__=[],this.size=0}function d_(g){var O=this.__data__,$=yi(O,g);if($<0)return!1;var X=O.length-1;return $==X?O.pop():Mt.call(O,$,1),--this.size,!0}function p_(g){var O=this.__data__,$=yi(O,g);return $<0?void 0:O[$][1]}function g_(g){return yi(this.__data__,g)>-1}function y_(g,O){var $=this.__data__,X=yi($,g);return X<0?(++this.size,$.push([g,O])):$[X][1]=O,this}Pt.prototype.clear=f_,Pt.prototype.delete=d_,Pt.prototype.get=p_,Pt.prototype.has=g_,Pt.prototype.set=y_;function Qt(g){var O=-1,$=g==null?0:g.length;for(this.clear();++O<$;){var X=g[O];this.set(X[0],X[1])}}function __(){this.size=0,this.__data__={hash:new Ne,map:new(Ce||Pt),string:new Ne}}function b_(g){var O=_i(this,g).delete(g);return this.size-=O?1:0,O}function w_(g){return _i(this,g).get(g)}function v_(g){return _i(this,g).has(g)}function m_(g,O){var $=_i(this,g),X=$.size;return $.set(g,O),this.size+=$.size==X?0:1,this}Qt.prototype.clear=__,Qt.prototype.delete=b_,Qt.prototype.get=w_,Qt.prototype.has=v_,Qt.prototype.set=m_;function gi(g){var O=-1,$=g==null?0:g.length;for(this.__data__=new Qt;++O<$;)this.add(g[O])}function E_(g){return this.__data__.set(g,i),this}function S_(g){return this.__data__.has(g)}gi.prototype.add=gi.prototype.push=E_,gi.prototype.has=S_;function jt(g){var O=this.__data__=new Pt(g);this.size=O.size}function D_(){this.__data__=new Pt,this.size=0}function O_(g){var O=this.__data__,$=O.delete(g);return this.size=O.size,$}function x_(g){return this.__data__.get(g)}function I_(g){return this.__data__.has(g)}function T_(g,O){var $=this.__data__;if($ instanceof Pt){var X=$.__data__;if(!Ce||X.length<r-1)return X.push([g,O]),this.size=++$.size,this;$=this.__data__=new Qt(X)}return $.set(g,O),this.size=$.size,this}jt.prototype.clear=D_,jt.prototype.delete=O_,jt.prototype.get=x_,jt.prototype.has=I_,jt.prototype.set=T_;function N_(g,O){var $=bi(g),X=!$&&H_(g),Te=!$&&!X&&Mn(g),se=!$&&!X&&!Te&&rc(g),Fe=$||X||Te||se,Ze=Fe?Ue(g.length,String):[],it=Ze.length;for(var Re in g)(O||ne.call(g,Re))&&!(Fe&&(Re=="length"||Te&&(Re=="offset"||Re=="parent")||se&&(Re=="buffer"||Re=="byteLength"||Re=="byteOffset")||j_(Re,it)))&&Ze.push(Re);return Ze}function yi(g,O){for(var $=g.length;$--;)if(Qa(g[$][0],O))return $;return-1}function R_(g,O,$){var X=O(g);return bi(g)?X:de(X,$(g))}function jr(g){return g==null?g===void 0?C:z:gt&&gt in Object(g)?$_(g):K_(g)}function ka(g){return Br(g)&&jr(g)==c}function Ya(g,O,$,X,Te){return g===O?!0:g==null||O==null||!Br(g)&&!Br(O)?g!==g&&O!==O:A_(g,O,$,X,Ya,Te)}function A_(g,O,$,X,Te,se){var Fe=bi(g),Ze=bi(O),it=Fe?h:Bt(g),Re=Ze?h:Bt(O);it=it==c?E:it,Re=Re==c?E:Re;var yt=it==E,Dt=Re==E,st=it==Re;if(st&&Mn(g)){if(!Mn(O))return!1;Fe=!0,yt=!1}if(st&&!yt)return se||(se=new jt),Fe||rc(g)?Xa(g,O,$,X,Te,se):F_(g,O,it,$,X,Te,se);if(!($&n)){var wt=yt&&ne.call(g,"__wrapped__"),vt=Dt&&ne.call(O,"__wrapped__");if(wt||vt){var qt=wt?g.value():g,Ct=vt?O.value():O;return se||(se=new jt),Te(qt,Ct,$,X,se)}}return st?(se||(se=new jt),U_(g,O,$,X,Te,se)):!1}function P_(g){if(!tc(g)||q_(g))return!1;var O=Za(g)?Se:q;return O.test(Zt(g))}function C_(g){return Br(g)&&ec(g.length)&&!!Y[jr(g)]}function L_(g){if(!z_(g))return pi(g);var O=[];for(var $ in Object(g))ne.call(g,$)&&$!="constructor"&&O.push($);return O}function Xa(g,O,$,X,Te,se){var Fe=$&n,Ze=g.length,it=O.length;if(Ze!=it&&!(Fe&&it>Ze))return!1;var Re=se.get(g);if(Re&&se.get(O))return Re==O;var yt=-1,Dt=!0,st=$&s?new gi:void 0;for(se.set(g,O),se.set(O,g);++yt<Ze;){var wt=g[yt],vt=O[yt];if(X)var qt=Fe?X(vt,wt,yt,O,g,se):X(wt,vt,yt,g,O,se);if(qt!==void 0){if(qt)continue;Dt=!1;break}if(st){if(!me(O,function(Ct,er){if(!ye(st,er)&&(wt===Ct||Te(wt,Ct,$,X,se)))return st.push(er)})){Dt=!1;break}}else if(!(wt===vt||Te(wt,vt,$,X,se))){Dt=!1;break}}return se.delete(g),se.delete(O),Dt}function F_(g,O,$,X,Te,se,Fe){switch($){case G:if(g.byteLength!=O.byteLength||g.byteOffset!=O.byteOffset)return!1;g=g.buffer,O=O.buffer;case K:return!(g.byteLength!=O.byteLength||!se(new St(g),new St(O)));case p:case m:case P:return Qa(+g,+O);case y:return g.name==O.name&&g.message==O.message;case w:case o:return g==O+"";case A:var Ze=fe;case d:var it=X&n;if(Ze||(Ze=ce),g.size!=O.size&&!it)return!1;var Re=Fe.get(g);if(Re)return Re==O;X|=s,Fe.set(g,O);var yt=Xa(Ze(g),Ze(O),X,Te,se,Fe);return Fe.delete(g),yt;case f:if(ze)return ze.call(g)==ze.call(O)}return!1}function U_(g,O,$,X,Te,se){var Fe=$&n,Ze=Ja(g),it=Ze.length,Re=Ja(O),yt=Re.length;if(it!=yt&&!Fe)return!1;for(var Dt=it;Dt--;){var st=Ze[Dt];if(!(Fe?st in O:ne.call(O,st)))return!1}var wt=se.get(g);if(wt&&se.get(O))return wt==O;var vt=!0;se.set(g,O),se.set(O,g);for(var qt=Fe;++Dt<it;){st=Ze[Dt];var Ct=g[st],er=O[st];if(X)var ic=Fe?X(er,Ct,st,O,g,se):X(Ct,er,st,g,O,se);if(!(ic===void 0?Ct===er||Te(Ct,er,$,X,se):ic)){vt=!1;break}qt||(qt=st=="constructor")}if(vt&&!qt){var wi=g.constructor,vi=O.constructor;wi!=vi&&"constructor"in g&&"constructor"in O&&!(typeof wi=="function"&&wi instanceof wi&&typeof vi=="function"&&vi instanceof vi)&&(vt=!1)}return se.delete(g),se.delete(O),vt}function Ja(g){return R_(g,W_,M_)}function _i(g,O){var $=g.__data__;return B_(O)?$[typeof O=="string"?"string":"hash"]:$.map}function fr(g,O){var $=pe(g,O);return P_($)?$:void 0}function $_(g){var O=ne.call(g,gt),$=g[gt];try{g[gt]=void 0;var X=!0}catch{}var Te=ve.call(g);return X&&(O?g[gt]=$:delete g[gt]),Te}var M_=Jt?function(g){return g==null?[]:(g=Object(g),be(Jt(g),function(O){return Tt.call(g,O)}))}:k_,Bt=jr;(Me&&Bt(new Me(new ArrayBuffer(1)))!=G||Ce&&Bt(new Ce)!=A||je&&Bt(je.resolve())!=I||Be&&Bt(new Be)!=d||qe&&Bt(new qe)!=L)&&(Bt=function(g){var O=jr(g),$=O==E?g.constructor:void 0,X=$?Zt($):"";if(X)switch(X){case Ge:return G;case We:return A;case ke:return I;case Ye:return d;case Xe:return L}return O});function j_(g,O){return O=O??a,!!O&&(typeof g=="number"||Z.test(g))&&g>-1&&g%1==0&&g<O}function B_(g){var O=typeof g;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?g!=="__proto__":g===null}function q_(g){return!!we&&we in g}function z_(g){var O=g&&g.constructor,$=typeof O=="function"&&O.prototype||re;return g===$}function K_(g){return ve.call(g)}function Zt(g){if(g!=null){try{return ge.call(g)}catch{}try{return g+""}catch{}}return""}function Qa(g,O){return g===O||g!==g&&O!==O}var H_=ka(function(){return arguments}())?ka:function(g){return Br(g)&&ne.call(g,"callee")&&!Tt.call(g,"callee")},bi=Array.isArray;function V_(g){return g!=null&&ec(g.length)&&!Za(g)}var Mn=Mr||Y_;function G_(g,O){return Ya(g,O)}function Za(g){if(!tc(g))return!1;var O=jr(g);return O==v||O==S||O==l||O==_}function ec(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=a}function tc(g){var O=typeof g;return g!=null&&(O=="object"||O=="function")}function Br(g){return g!=null&&typeof g=="object"}var rc=he?Pe(he):C_;function W_(g){return V_(g)?N_(g):L_(g)}function k_(){return[]}function Y_(){return!1}t.exports=G_})(On,On.exports);var vg=On.exports,mg=Object.defineProperty,sa=Object.getOwnPropertySymbols,Eg=Object.prototype.hasOwnProperty,Sg=Object.prototype.propertyIsEnumerable,oa=(t,e,r)=>e in t?mg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e)=>{for(var r in e||(e={}))Eg.call(e,r)&&oa(t,r,e[r]);if(sa)for(var r of sa(e))Sg.call(e,r)&&oa(t,r,e[r]);return t};function Dg(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=t.length,h=t.charAt(0),l=Math.log(c)/Math.log(256),p=Math.log(256)/Math.log(c);function m(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var A=0,P=0,z=0,E=S.length;z!==E&&S[z]===0;)z++,A++;for(var I=(E-z)*p+1>>>0,_=new Uint8Array(I);z!==E;){for(var w=S[z],d=0,o=I-1;(w!==0||d<P)&&o!==-1;o--,d++)w+=256*_[o]>>>0,_[o]=w%c>>>0,w=w/c>>>0;if(w!==0)throw new Error("Non-zero carry");P=d,z++}for(var f=I-P;f!==I&&_[f]===0;)f++;for(var C=h.repeat(A);f<I;++f)C+=t.charAt(_[f]);return C}function y(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var A=0;if(S[A]!==" "){for(var P=0,z=0;S[A]===h;)P++,A++;for(var E=(S.length-A)*l+1>>>0,I=new Uint8Array(E);S[A];){var _=r[S.charCodeAt(A)];if(_===255)return;for(var w=0,d=E-1;(_!==0||w<z)&&d!==-1;d--,w++)_+=c*I[d]>>>0,I[d]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");z=w,A++}if(S[A]!==" "){for(var o=E-z;o!==E&&I[o]===0;)o++;for(var f=new Uint8Array(P+(E-o)),C=P;o!==E;)f[C++]=I[o++];return f}}}function v(S){var A=y(S);if(A)return A;throw new Error(`Non-${e} character`)}return{encode:m,decodeUnsafe:y,decode:v}}var Og=Dg,xg=Og;const aa=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Ig=t=>new TextEncoder().encode(t),Tg=t=>new TextDecoder().decode(t);class Ng{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Rg{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ca(this,e)}}class Ag{constructor(e){this.decoders=e}or(e){return ca(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ca=(t,e)=>new Ag(lt(lt({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class Pg{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Ng(e,r,i),this.decoder=new Rg(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ci=({name:t,prefix:e,encode:r,decode:i})=>new Pg(t,e,r,i),Cr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=xg(r,e);return ci({prefix:t,name:e,encode:i,decode:s=>aa(n(s))})},Cg=(t,e,r,i)=>{const n={};for(let p=0;p<e.length;++p)n[e[p]]=p;let s=t.length;for(;t[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,h=0,l=0;for(let p=0;p<s;++p){const m=n[t[p]];if(m===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|m,c+=r,c>=8&&(c-=8,a[l++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return a},Lg=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],a+=8;a>r;)a-=r,s+=e[n&c>>a];if(a&&(s+=e[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},rt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ci({prefix:e,name:t,encode(n){return Lg(n,i,r)},decode(n){return Cg(n,i,r,t)}}),Fg=ci({prefix:"\0",name:"identity",encode:t=>Tg(t),decode:t=>Ig(t)});var Ug=Object.freeze({__proto__:null,identity:Fg});const $g=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Mg=Object.freeze({__proto__:null,base2:$g});const jg=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Bg=Object.freeze({__proto__:null,base8:jg});const qg=Cr({prefix:"9",name:"base10",alphabet:"0123456789"});var zg=Object.freeze({__proto__:null,base10:qg});const Kg=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Hg=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Vg=Object.freeze({__proto__:null,base16:Kg,base16upper:Hg});const Gg=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Wg=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),kg=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Yg=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xg=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Jg=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Qg=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Zg=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),e0=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var t0=Object.freeze({__proto__:null,base32:Gg,base32upper:Wg,base32pad:kg,base32padupper:Yg,base32hex:Xg,base32hexupper:Jg,base32hexpad:Qg,base32hexpadupper:Zg,base32z:e0});const r0=Cr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i0=Cr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var n0=Object.freeze({__proto__:null,base36:r0,base36upper:i0});const s0=Cr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),o0=Cr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var a0=Object.freeze({__proto__:null,base58btc:s0,base58flickr:o0});const c0=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),u0=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),l0=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),h0=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var f0=Object.freeze({__proto__:null,base64:c0,base64pad:u0,base64url:l0,base64urlpad:h0});const ua=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),d0=ua.reduce((t,e,r)=>(t[r]=e,t),[]),p0=ua.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function g0(t){return t.reduce((e,r)=>(e+=d0[r],e),"")}function y0(t){const e=[];for(const r of t){const i=p0[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const _0=ci({prefix:"\u{1F680}",name:"base256emoji",encode:g0,decode:y0});var b0=Object.freeze({__proto__:null,base256emoji:_0}),w0=ha,la=128,v0=127,m0=~v0,E0=Math.pow(2,31);function ha(t,e,r){e=e||[],r=r||0;for(var i=r;t>=E0;)e[r++]=t&255|la,t/=128;for(;t&m0;)e[r++]=t&255|la,t>>>=7;return e[r]=t|0,ha.bytes=r-i+1,e}var S0=xn,D0=128,fa=127;function xn(t,i){var r=0,i=i||0,n=0,s=i,a,c=t.length;do{if(s>=c)throw xn.bytes=0,new RangeError("Could not decode varint");a=t[s++],r+=n<28?(a&fa)<<n:(a&fa)*Math.pow(2,n),n+=7}while(a>=D0);return xn.bytes=s-i,r}var O0=Math.pow(2,7),x0=Math.pow(2,14),I0=Math.pow(2,21),T0=Math.pow(2,28),N0=Math.pow(2,35),R0=Math.pow(2,42),A0=Math.pow(2,49),P0=Math.pow(2,56),C0=Math.pow(2,63),L0=function(t){return t<O0?1:t<x0?2:t<I0?3:t<T0?4:t<N0?5:t<R0?6:t<A0?7:t<P0?8:t<C0?9:10},F0={encode:w0,decode:S0,encodingLength:L0},da=F0;const pa=(t,e,r=0)=>(da.encode(t,e,r),e),ga=t=>da.encodingLength(t),In=(t,e)=>{const r=e.byteLength,i=ga(t),n=i+ga(r),s=new Uint8Array(n+r);return pa(t,s,0),pa(r,s,i),s.set(e,n),new U0(t,r,e,s)};class U0{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const ya=({name:t,code:e,encode:r})=>new $0(t,e,r);class $0{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?In(this.code,r):r.then(i=>In(this.code,i))}else throw Error("Unknown type, must be binary type")}}const _a=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),M0=ya({name:"sha2-256",code:18,encode:_a("SHA-256")}),j0=ya({name:"sha2-512",code:19,encode:_a("SHA-512")});var B0=Object.freeze({__proto__:null,sha256:M0,sha512:j0});const ba=0,q0="identity",wa=aa;var z0=Object.freeze({__proto__:null,identity:{code:ba,name:q0,encode:wa,digest:t=>In(ba,wa(t))}});new TextEncoder,new TextDecoder;const va=lt(lt(lt(lt(lt(lt(lt(lt(lt(lt({},Ug),Mg),Bg),zg),Vg),t0),n0),a0),f0),b0);lt(lt({},B0),z0);function ma(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function K0(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ma(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ea(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Sa=Ea("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Tn=Ea("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=K0(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),H0=lt({utf8:Sa,"utf-8":Sa,hex:va.base16,latin1:Tn,ascii:Tn,binary:Tn},va);function V0(t,e="utf8"){const r=H0[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ma(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const Da="wc",G0=2,Nn="core",$t=`${Da}@2:${Nn}:`,W0={name:Nn,logger:"error"},k0={database:":memory:"},Y0="crypto",Oa="client_ed25519_seed",X0=Q.ONE_DAY,J0="keychain",Q0="0.3",Z0="messages",ey="0.3",ty=Q.SIX_HOURS,ry="publisher",xa="irn",iy="error",Ia="wss://relay.walletconnect.com",Ta="wss://relay.walletconnect.org",ny="relayer",Ae={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},sy="_subscription",Lr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},oy=Q.ONE_SECOND/2,ay="2.9.2",cy=1e4,uy="0.3",ly="WALLETCONNECT_CLIENT_ID",xt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},hy="subscription",fy="0.3",dy=Q.FIVE_SECONDS*1e3,py="pairing",gy="0.3",Fr={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},It={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},yy="history",_y="0.3",by="expirer",_t={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},wy="0.3",Rn="verify-api",Na="https://verify.walletconnect.com";class vy{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=J0,this.version=Q0,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=_e.generateChildLogger(r,this.name)}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Fo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Uo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class my{constructor(e,r,i){this.core=e,this.logger=r,this.name=Y0,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=so(n);return no(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Sd();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),a=so(s),c=hn();return await Af(c,n,X0,a)},this.generateSharedKey=(n,s,a)=>{this.isInitialized();const c=this.getPrivateKey(n),h=Dd(c,s);return this.setSymKey(h,a)},this.setSymKey=async(n,s)=>{this.isInitialized();const a=s||Od(n);return await this.keychain.set(a,n),a},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,a)=>{this.isInitialized();const c=No(a),h=zi(s);if(Ro(c)){const y=c.senderPublicKey,v=c.receiverPublicKey;n=await this.generateSharedKey(y,v)}const l=this.getSymKey(n),{type:p,senderPublicKey:m}=c;return Id({type:p,symKey:l,message:h,senderPublicKey:m})},this.decode=async(n,s,a)=>{this.isInitialized();const c=Rd(s,a);if(Ro(c)){const h=c.receiverPublicKey,l=c.senderPublicKey;n=await this.generateSharedKey(h,l)}try{const h=this.getSymKey(n),l=Td({symKey:h,encoded:s});return Ts(l)}catch(h){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}},this.getPayloadType=n=>{const s=ti(n);return Tr(s.type)},this.getPayloadSenderPublicKey=n=>{const s=ti(n);return s.senderPublicKey?at(s.senderPublicKey,ct):void 0},this.core=e,this.logger=_e.generateChildLogger(r,this.name),this.keychain=i||new vy(this.core,this.logger)}get context(){return _e.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Oa)}catch{e=hn(),await this.keychain.set(Oa,e)}return V0(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ey extends ll{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Z0,this.version=ey,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=ar(n);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[s]<"u"||(a[s]=n,this.messages.set(i,a),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),a=ar(n);return typeof s[a]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=_e.generateChildLogger(e,this.name),this.core=r}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Fo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Uo(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Sy extends hl{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ht.exports.EventEmitter,this.name=ry,this.queue=new Map,this.publishTimeout=Q.toMiliseconds(Q.TEN_SECONDS),this.queueTimeout=Q.toMiliseconds(Q.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,n,s)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});try{const a=s?.ttl||ty,c=gn(s),h=s?.prompt||!1,l=s?.tag||0,p=s?.id||mn().toString(),m={topic:i,message:n,opts:{ttl:a,relay:c,prompt:h,tag:l,id:p}},y=setTimeout(()=>this.queue.set(p,m),this.queueTimeout);try{await await ri(this.rpcPublish(i,n,a,c,h,l,p),this.publishTimeout),clearTimeout(y),this.relayer.events.emit(Ae.publish,m)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}})}catch(a){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(a),a}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=_e.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return _e.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,s,a,c){var h,l,p,m;const y={method:ii(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:s,tag:a},id:c};return ut((h=y.params)==null?void 0:h.prompt)&&((l=y.params)==null||delete l.prompt),ut((p=y.params)==null?void 0:p.tag)&&((m=y.params)==null||delete m.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:y}),this.relayer.request(y)}onPublish(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(ir.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ae.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ae.message_ack,e=>{this.onPublish(e.id.toString())})}}class Dy{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Oy=Object.defineProperty,xy=Object.defineProperties,Iy=Object.getOwnPropertyDescriptors,Ra=Object.getOwnPropertySymbols,Ty=Object.prototype.hasOwnProperty,Ny=Object.prototype.propertyIsEnumerable,Aa=(t,e,r)=>e in t?Oy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ur=(t,e)=>{for(var r in e||(e={}))Ty.call(e,r)&&Aa(t,r,e[r]);if(Ra)for(var r of Ra(e))Ny.call(e,r)&&Aa(t,r,e[r]);return t},An=(t,e)=>xy(t,Iy(e));class Ry extends pl{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Dy,this.events=new ht.exports.EventEmitter,this.name=hy,this.version=fy,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=$t,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=gn(n),a={topic:i,relay:s};this.pending.set(i,a);const c=await this.rpcSubscribe(i,s);return this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),c}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,s)=>{const a=new Q.Watch;a.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),a.stop(this.pendingSubscriptionWatchLabel),n(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=dy&&(clearInterval(c),a.stop(this.pendingSubscriptionWatchLabel),s(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=_e.generateChildLogger(r,this.name),this.clientId=""}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=gn(i);await this.rpcUnsubscribe(e,r,n);const s=He("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:ii(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await ri(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ae.connection_stalled)}return ar(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ii(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await ri(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ae.connection_stalled)}}rpcUnsubscribe(e,r,i){const n={method:ii(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,An(Ur({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ur({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,Ur({},r)),this.topicMap.set(r.topic,e),this.events.emit(xt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(xt.deleted,An(Ur({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(xt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(xt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Nr(r)&&this.onBatchSubscribe(r.map((i,n)=>An(Ur({},e[n]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(ir.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ae.connect,async()=>{await this.onConnect()}),this.relayer.on(Ae.disconnect,()=>{this.onDisconnect()}),this.events.on(xt.created,async e=>{const r=xt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(xt.deleted,async e=>{const r=xt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var Ay=Object.defineProperty,Pa=Object.getOwnPropertySymbols,Py=Object.prototype.hasOwnProperty,Cy=Object.prototype.propertyIsEnumerable,Ca=(t,e,r)=>e in t?Ay(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ly=(t,e)=>{for(var r in e||(e={}))Py.call(e,r)&&Ca(t,r,e[r]);if(Pa)for(var r of Pa(e))Cy.call(e,r)&&Ca(t,r,e[r]);return t};class Fy extends fl{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ht.exports.EventEmitter,this.name=ny,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?_e.generateChildLogger(e.logger,this.name):_e.pino(_e.getDefaultLoggerOptions({level:e.logger||iy})),this.messages=new Ey(this.logger,e.core),this.subscriber=new Ry(this,this.logger),this.publisher=new Sy(this,this.logger),this.relayUrl=e?.relayUrl||Ia,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ta}...`),await this.restartTransport(Ta)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},cy)}get context(){return _e.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";return n||(await Promise.all([new Promise(s=>{this.subscriber.once(xt.created,a=>{a.topic===e&&s()})}),new Promise(async s=>{n=await this.subscriber.subscribe(e,r),s()})]),n)}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Ae.transport_closed))}async transportOpen(e){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=e||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(xt.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,i)=>{await ri(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(n=>i(n)).then(()=>r()).finally(()=>this.removeListener(Ae.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(Ae.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.events.emit(Ae.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=e||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(Lr.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new gg(new wg(qd({sdkVersion:ay,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Dn(e)){if(!e.method.endsWith(sy))return;const r=e.params,{topic:i,message:n,publishedAt:s}=r.data,a={topic:i,message:n,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ly({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else ai(e)&&this.events.emit(Ae.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Ae.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=En(e.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(Lr.payload,e=>this.onProviderPayload(e)),this.provider.on(Lr.connect,()=>{this.events.emit(Ae.connect)}),this.provider.on(Lr.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(Lr.error,e=>{this.logger.error(e),this.events.emit(Ae.error,e)})}registerEventListeners(){this.events.on(Ae.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(Ae.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},Q.toMiliseconds(oy))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Uy=Object.defineProperty,La=Object.getOwnPropertySymbols,$y=Object.prototype.hasOwnProperty,My=Object.prototype.propertyIsEnumerable,Fa=(t,e,r)=>e in t?Uy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ua=(t,e)=>{for(var r in e||(e={}))$y.call(e,r)&&Fa(t,r,e[r]);if(La)for(var r of La(e))My.call(e,r)&&Fa(t,r,e[r]);return t};class ui extends dl{constructor(e,r,i,n=$t,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=uy,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!ut(a)?this.map.set(this.getKey(a),a):lp(a)?this.map.set(a.id,a):hp(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,c)=>{this.isInitialized(),this.map.has(a)?await this.update(a,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:c}),this.map.set(a,c),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(c=>Object.keys(a).every(h=>vg(c[h],a[h]))):this.values),this.update=async(a,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:c});const h=Ua(Ua({},this.getData(a)),c);this.map.set(a,h),await this.persist()},this.delete=async(a,c)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:c}),this.map.delete(a),await this.persist())},this.logger=_e.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class jy{constructor(e,r){this.core=e,this.logger=r,this.name=py,this.version=gy,this.events=new ht.exports,this.initialized=!1,this.storagePrefix=$t,this.ignoredPayloadTypes=[Yt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=hn(),n=await this.core.crypto.setSymKey(i),s=mt(Q.FIVE_MINUTES),a={protocol:xa},c={topic:n,expiry:s,relay:a,active:!1},h=ep({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:a}=Jd(i.uri);if(this.pairings.keys.includes(n))throw new Error(`Pairing already exists: ${n}`);if(this.core.crypto.hasKeys(n))throw new Error(`Keychain already exists: ${n}`);const c=mt(Q.FIVE_MINUTES),h={topic:n,relay:a,expiry:c,active:!1};return await this.pairings.set(n,h),await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:a}),this.core.expirer.set(n,c),i.activatePairing&&await this.activate({topic:n}),h},this.activate=async({topic:i})=>{this.isInitialized();const n=mt(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:a,resolve:c,reject:h}=cr();this.events.once($e("pairing_ping",s),({error:l})=>{l?h(l):c()}),await a()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",He("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const a=oi(n,s),c=await this.core.crypto.encode(i,a),h=Fr[n].req;return this.core.history.set(i,a),this.core.relayer.publish(i,c,h),a.id},this.sendResult=async(i,n,s)=>{const a=En(i,s),c=await this.core.crypto.encode(n,a),h=await this.core.history.get(n,i),l=Fr[h.request.method].res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.sendError=async(i,n,s)=>{const a=Sn(i,s),c=await this.core.crypto.encode(n,a),h=await this.core.history.get(n,i),l=Fr[h.request.method]?Fr[h.request.method].res:Fr.unregistered_method.res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,He("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Ut(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,a=(await this.core.history.get(n,s.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit("pairing_ping",{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{At(n)?this.events.emit($e("pairing_ping",s),{}):Et(n)&&this.events.emit($e("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit("pairing_delete",{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:a}=n;try{if(this.registeredMethods.includes(a))return;const c=He("WC_METHOD_UNSUPPORTED",a);await this.sendError(s,i,c),this.logger.error(c)}catch(c){await this.sendError(s,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(He("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!dt(i)){const{message:n}=V("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!up(i.uri)){const{message:n}=V("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!dt(i)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!dt(i)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ve(i,!1)){const{message:n}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=V("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=_e.generateChildLogger(r,this.name),this.pairings=new ui(this.core,this.logger,this.name,this.storagePrefix)}get context(){return _e.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ae.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{Dn(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):ai(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(_t.expired,async e=>{const{topic:r}=Mo(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class By extends ul{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ht.exports.EventEmitter,this.name=yy,this.version=_y,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const a={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:mt(Q.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(It.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Et(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(It.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(It.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=_e.generateChildLogger(r,this.name)}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:oi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(It.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(It.created,e=>{const r=It.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(It.updated,e=>{const r=It.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(It.deleted,e=>{const r=It.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(ir.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{Q.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class qy extends gl{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ht.exports.EventEmitter,this.name=by,this.version=wy,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),a={target:s,expiry:n};this.expirations.set(s,a),this.checkExpiry(s,a),this.events.emit(_t.created,{target:s,expiration:a})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(_t.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=_e.generateChildLogger(r,this.name)}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return zd(e);if(typeof e=="number")return Kd(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(_t.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(_t.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(ir.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(_t.created,e=>{const r=_t.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(_t.expired,e=>{const r=_t.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(_t.deleted,e=>{const r=_t.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class zy extends yl{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=Rn,this.initialized=!1,this.init=async i=>{Lo()||!dn()||(this.verifyUrl=i?.verifyUrl||Na,await this.createIframe())},this.register=async i=>{var n;if(this.initialized||await this.init(),!!this.iframe)try{(n=this.iframe.contentWindow)==null||n.postMessage(i.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${i.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async i=>{var n;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${i.attestationId}`);const s=this.startAbortTimer(Q.FIVE_SECONDS),a=await fetch(`${this.verifyUrl}/attestation/${i.attestationId}`,{signal:this.abortController.signal});return clearTimeout(s),a.status===200?(n=await a.json())==null?void 0:n.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((i,n)=>{if(document.getElementById(Rn))return i();const s=document.createElement("iframe");s.setAttribute("id",Rn),s.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),s.style.display="none",s.addEventListener("load",()=>{this.initialized=!0,i()}),s.addEventListener("error",a=>{n(a)}),document.body.append(s),this.iframe=s}),new Promise(i=>{setTimeout(()=>i("iframe load timeout"),Q.toMiliseconds(Q.ONE_SECOND/2))})])}catch(i){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(i)}},this.logger=_e.generateChildLogger(r,this.name),this.verifyUrl=Na,this.abortController=new AbortController,this.isDevEnv=fn()&&process.env.IS_VITEST}get context(){return _e.getLoggerContext(this.logger)}startAbortTimer(e){return setTimeout(()=>this.abortController.abort(),Q.toMiliseconds(e))}}var Ky=Object.defineProperty,$a=Object.getOwnPropertySymbols,Hy=Object.prototype.hasOwnProperty,Vy=Object.prototype.propertyIsEnumerable,Ma=(t,e,r)=>e in t?Ky(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ja=(t,e)=>{for(var r in e||(e={}))Hy.call(e,r)&&Ma(t,r,e[r]);if($a)for(var r of $a(e))Vy.call(e,r)&&Ma(t,r,e[r]);return t};class Pn extends cl{constructor(e){super(e),this.protocol=Da,this.version=G0,this.name=Nn,this.events=new ht.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ia;const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:_e.pino(_e.getDefaultLoggerOptions({level:e?.logger||W0.logger}));this.logger=_e.generateChildLogger(r,this.name),this.heartbeat=new ir.HeartBeat,this.crypto=new my(this,this.logger,e?.keychain),this.history=new By(this,this.logger),this.expirer=new qy(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Mc(ja(ja({},k0),e?.storageOptions)),this.relayer=new Fy({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new jy(this,this.logger),this.verify=new zy(this.projectId||"",this.logger)}static async init(e){const r=new Pn(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(ly,i),r}get context(){return _e.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Gy=Pn,Cn="wc",Ln=2,Fn="client",li=`${Cn}@${Ln}:${Fn}:`,hi={name:Fn,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Wy={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire"},ky={database:":memory:"},Un="WALLETCONNECT_DEEPLINK_CHOICE",Yy={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Xy="history",Jy="0.3",Ba="proposal",Qy=Q.THIRTY_DAYS,qa="Proposal expired",za="session",$r=Q.SEVEN_DAYS,Ka="engine",lr={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},fi={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},hr={idle:"idle",active:"active"},Ha="request",Va=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Zy=Object.defineProperty,e_=Object.defineProperties,t_=Object.getOwnPropertyDescriptors,Ga=Object.getOwnPropertySymbols,r_=Object.prototype.hasOwnProperty,i_=Object.prototype.propertyIsEnumerable,Wa=(t,e,r)=>e in t?Zy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bt=(t,e)=>{for(var r in e||(e={}))r_.call(e,r)&&Wa(t,r,e[r]);if(Ga)for(var r of Ga(e))i_.call(e,r)&&Wa(t,r,e[r]);return t},$n=(t,e)=>e_(t,t_(e));class n_ extends bl{constructor(e){super(e),this.name=Ka,this.events=new ht.exports,this.initialized=!1,this.ignoredPayloadTypes=[Yt],this.requestQueue={state:hr.idle,requests:[]},this.requestQueueDelay=Q.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(lr)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},Q.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{this.isInitialized();const i=$n(bt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:a,sessionProperties:c,relays:h}=i;let l=n,p,m=!1;if(l&&(m=this.client.core.pairing.pairings.get(l).active),!l||!m){const{topic:I,uri:_}=await this.client.core.pairing.create();l=I,p=_}const y=await this.client.core.crypto.generateKeyPair(),v=bt({requiredNamespaces:s,optionalNamespaces:a,relays:h??[{protocol:xa}],proposer:{publicKey:y,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:S,resolve:A,done:P}=cr(Q.FIVE_MINUTES,qa);if(this.events.once($e("session_connect"),async({error:I,session:_})=>{if(I)S(I);else if(_){_.self.publicKey=y;const w=$n(bt({},_),{requiredNamespaces:_.requiredNamespaces,optionalNamespaces:_.optionalNamespaces});await this.client.session.set(_.topic,w),await this.setExpiry(_.topic,_.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:_.peer.metadata}),A(w)}}),!l){const{message:I}=V("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(I)}const z=await this.sendRequest(l,"wc_sessionPropose",v),E=mt(Q.FIVE_MINUTES);return await this.setProposal(z,bt({id:z,expiry:E},v)),{uri:p,approval:P}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:s,sessionProperties:a}=r,c=this.client.proposal.get(i);let{pairingTopic:h,proposer:l,requiredNamespaces:p,optionalNamespaces:m}=c;h=h||"",Rr(p)||(p=np(s,"approve()"));const y=await this.client.core.crypto.generateKeyPair(),v=l.publicKey,S=await this.client.core.crypto.generateSharedKey(y,v);h&&i&&(await this.client.core.pairing.updateMetadata({topic:h,metadata:l.metadata}),await this.sendResult(i,h,{relay:{protocol:n??"irn"},responderPublicKey:y}),await this.client.proposal.delete(i,He("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h}));const A=bt({relay:{protocol:n??"irn"},namespaces:s,requiredNamespaces:p,optionalNamespaces:m,pairingTopic:h,controller:{publicKey:y,metadata:this.client.metadata},expiry:mt($r)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(S),await this.sendRequest(S,"wc_sessionSettle",A);const P=$n(bt({},A),{topic:S,pairingTopic:h,acknowledged:!1,self:A.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:y});return await this.client.session.set(S,P),await this.setExpiry(S,mt($r)),{topic:S,acknowledged:()=>new Promise(z=>setTimeout(()=>z(this.client.session.get(S)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:s}=this.client.proposal.get(i);s&&(await this.sendError(i,s,n),await this.client.proposal.delete(i,He("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,s=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:a,resolve:c,reject:h}=cr();return this.events.once($e("session_update",s),({error:l})=>{l?h(l):c()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:a}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:s,resolve:a,reject:c}=cr();return this.events.once($e("session_extend",n),({error:h})=>{h?c(h):a()}),await this.setExpiry(i,mt($r)),{acknowledged:s}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:s,expiry:a}=r,c=await this.sendRequest(s,"wc_sessionRequest",{request:n,chainId:i},a),{done:h,resolve:l,reject:p}=cr(a);this.events.once($e("session_request",c),({error:y,result:v})=>{y?p(y):l(v)}),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c});const m=await this.client.core.storage.getItem(Un);return Hd({id:c,topic:s,wcDeepLink:m}),await h()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n;At(n)?await this.sendResult(s,i,n.result):Et(n)&&await this.sendError(s,i,n.error),this.cleanupAfterResponse(r)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:s,resolve:a,reject:c}=cr();this.events.once($e("session_ping",n),({error:h})=>{h?c(h):a()}),await s()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:s})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=mn().toString();let s;const a=c=>{c?.id.toString()===n&&(this.client.core.relayer.events.removeListener(Ae.message_ack,a),s())};await Promise.all([new Promise(c=>{s=c,this.client.core.relayer.on(Ae.message_ack,a)}),this.sendRequest(i,"wc_sessionDelete",He("USER_DISCONNECTED"),void 0,n)]),await this.deleteSession(i)}else await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>ap(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var a,c;return((a=s.peerMetadata)==null?void 0:a.url)&&((c=s.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,He("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(n.publicKey)&&await this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Un).catch(s=>this.client.logger.warn(s))},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,He("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.requestQueue.requests=this.requestQueue.requests.filter(s=>s.id!==r),n&&(this.requestQueue.state=hr.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=lr.wc_sessionRequest.req.ttl,{id:n,topic:s,params:a}=r;await this.client.pendingRequest.set(n,{id:n,topic:s,params:a}),i&&this.client.core.expirer.set(n,mt(i))},this.sendRequest=async(r,i,n,s,a)=>{const c=oi(i,n);if(dn()&&Va.includes(i)){const p=ar(JSON.stringify(c));await this.client.core.verify.register({attestationId:p})}const h=await this.client.core.crypto.encode(r,c),l=lr[i].req;return s&&(l.ttl=s),a&&(l.id=a),this.client.core.history.set(r,c),this.client.core.relayer.publish(r,h,l),c.id},this.sendResult=async(r,i,n)=>{const s=En(r,n),a=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),h=lr[c.request.method].res;this.client.core.relayer.publish(i,a,h),await this.client.core.history.resolve(s)},this.sendError=async(r,i,n)=>{const s=Sn(r,n),a=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),h=lr[c.request.method].res;this.client.core.relayer.publish(i,a,h),await this.client.core.history.resolve(s)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Ut(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Ut(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,s=n.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,s=(await this.client.core.history.get(i,n.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:n}=V("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidConnect(bt({},i.params));const a=mt(Q.FIVE_MINUTES),c=bt({id:s,pairingTopic:r,expiry:a},n);await this.setProposal(s,c);const h=ar(JSON.stringify(i)),l=await this.getVerifyContext(h,c.proposer.metadata);this.client.events.emit("session_proposal",{id:s,params:c,verifyContext:l})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(At(i)){const{result:s}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const l=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const p=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:p}),await this.client.core.pairing.activate({topic:r})}else Et(i)&&(await this.client.proposal.delete(n,He("USER_DISCONNECTED")),this.events.emit($e("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:a,controller:c,expiry:h,namespaces:l,requiredNamespaces:p,optionalNamespaces:m,sessionProperties:y,pairingTopic:v}=i.params,S=bt({topic:r,relay:a,expiry:h,namespaces:l,acknowledged:!0,pairingTopic:v,requiredNamespaces:p,optionalNamespaces:m,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},y&&{sessionProperties:y});await this.sendResult(i.id,r,!0),this.events.emit($e("session_connect"),{session:S}),this.cleanupDuplicatePairings(S)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;At(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit($e("session_approve",n),{})):Et(i)&&(await this.client.session.delete(r,He("USER_DISCONNECTED")),this.events.emit($e("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidUpdate(bt({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult(s,r,!0),this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;At(i)?this.events.emit($e("session_update",n),{}):Et(i)&&this.events.emit($e("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,mt($r)),await this.sendResult(n,r,!0),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;At(i)?this.events.emit($e("session_extend",n),{}):Et(i)&&this.events.emit($e("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{At(i)?this.events.emit($e("session_ping",n),{}):Et(i)&&this.events.emit($e("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(Ae.publish,async()=>{s(await this.deleteSession(r))})}),this.sendResult(n,r,!0)]),this.client.events.emit("session_delete",{id:n,topic:r})}catch(s){this.client.logger.error(s)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidRequest(bt({topic:r},s)),await this.setPendingSessionRequest({id:n,topic:r,params:s}),this.addRequestToQueue({id:n,topic:r,params:s}),await this.processRequestQueue()}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;At(i)?this.events.emit($e("session_request",n),{result:i.result}):Et(i)&&this.events.emit($e("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidEmit(bt({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s})}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.addRequestToQueue=r=>{this.requestQueue.requests.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=hr.idle,this.processRequestQueue()},Q.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===hr.active){this.client.logger.info("session request queue is already active.");return}const r=this.requestQueue.requests[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:i,topic:n,params:s}=r,a=ar(JSON.stringify({id:i,params:s})),c=this.client.session.get(n),h=await this.getVerifyContext(a,c.peer.metadata);this.requestQueue.state=hr.active,this.client.events.emit("session_request",{id:i,topic:n,params:s,verifyContext:h})}catch(i){this.client.logger.error(i)}},this.isValidConnect=async r=>{if(!dt(r)){const{message:h}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:a,relays:c}=r;if(ut(i)||await this.isValidPairingTopic(i),!wp(c,!0)){const{message:h}=V("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}!ut(n)&&Rr(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!ut(s)&&Rr(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),ut(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(r,i)=>{const n=bp(r,"connect()",i);if(n)throw new Error(n.message)},this.isValidApprove=async r=>{if(!dt(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:a}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),h=si(n,"approve()");if(h)throw new Error(h.message);const l=Vo(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!Ve(s,!0)){const{message:p}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(p)}ut(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async r=>{if(!dt(r)){const{message:s}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!mp(n)){const{message:s}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!dt(r)){const{message:l}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:n,namespaces:s,expiry:a}=r;if(!Ko(i)){const{message:l}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=fp(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=si(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Ut(a)){const{message:l}=V("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async r=>{if(!dt(r)){const{message:h}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(h)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const s=this.client.session.get(i),a=si(n,"update()");if(a)throw new Error(a.message);const c=Vo(s.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!dt(r)){const{message:n}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!dt(r)){const{message:h}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(h)}const{topic:i,request:n,chainId:s,expiry:a}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Ho(c,s)){const{message:h}=V("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(h)}if(!Ep(n)){const{message:h}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(h)}if(!Op(c,s,n.method)){const{message:h}=V("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(h)}if(a&&!Np(a,fi)){const{message:h}=V("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${fi.min} and ${fi.max}`);throw new Error(h)}},this.isValidRespond=async r=>{if(!dt(r)){const{message:s}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(s)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!Sp(n)){const{message:s}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidPing=async r=>{if(!dt(r)){const{message:n}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!dt(r)){const{message:c}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Ho(a,s)){const{message:c}=V("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(c)}if(!Dp(n)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!xp(a,s,n.name)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!dt(r)){const{message:n}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const n={verified:{verifyUrl:i.verifyUrl||"",validation:"UNKNOWN",origin:i.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});s&&(n.verified.origin=s,n.verified.validation=s===i.url?"VALID":"INVALID")}catch(s){this.client.logger.error(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(n=>{if(!Ve(n,!1)){const{message:s}=V("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(s)}})}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Ae.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);try{Dn(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):ai(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.client.core.history.delete(r,n.id)):this.onRelayEventUnknownPayload({topic:r,payload:n})}catch(s){this.client.logger.error(s)}})}registerExpirerEvents(){this.client.core.expirer.on(_t.expired,async e=>{const{topic:r,id:i}=Mo(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Ve(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ve(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ve(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!vp(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class s_ extends ui{constructor(e,r){super(e,r,Ba,li),this.core=e,this.logger=r}}class o_ extends ui{constructor(e,r){super(e,r,za,li),this.core=e,this.logger=r}}class a_ extends ui{constructor(e,r){super(e,r,Ha,li,i=>i.id),this.core=e,this.logger=r}}class di extends _l{constructor(e){super(e),this.protocol=Cn,this.version=Ln,this.name=hi.name,this.events=new ht.exports.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=e?.name||hi.name,this.metadata=e?.metadata||$d();const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:_e.pino(_e.getDefaultLoggerOptions({level:e?.logger||hi.logger}));this.core=e?.core||new Gy(e),this.logger=_e.generateChildLogger(r,this.name),this.session=new o_(this.core,this.logger),this.proposal=new s_(this.core,this.logger),this.pendingRequest=new a_(this.core,this.logger),this.engine=new n_(this)}static async init(e){const r=new di(e);return await r.initialize(),r}get context(){return _e.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const c_=di;Oe.ENGINE_CONTEXT=Ka,Oe.ENGINE_RPC_OPTS=lr,Oe.HISTORY_CONTEXT=Xy,Oe.HISTORY_EVENTS=Yy,Oe.HISTORY_STORAGE_VERSION=Jy,Oe.METHODS_TO_VERIFY=Va,Oe.PROPOSAL_CONTEXT=Ba,Oe.PROPOSAL_EXPIRY=Qy,Oe.PROPOSAL_EXPIRY_MESSAGE=qa,Oe.REQUEST_CONTEXT=Ha,Oe.REQUEST_QUEUE_STATES=hr,Oe.SESSION_CONTEXT=za,Oe.SESSION_EXPIRY=$r,Oe.SESSION_REQUEST_EXPIRY_BOUNDARIES=fi,Oe.SIGN_CLIENT_CONTEXT=Fn,Oe.SIGN_CLIENT_DEFAULT=hi,Oe.SIGN_CLIENT_EVENTS=Wy,Oe.SIGN_CLIENT_PROTOCOL=Cn,Oe.SIGN_CLIENT_STORAGE_OPTIONS=ky,Oe.SIGN_CLIENT_STORAGE_PREFIX=li,Oe.SIGN_CLIENT_VERSION=Ln,Oe.SignClient=c_,Oe.WALLETCONNECT_DEEPLINK_CHOICE=Un,Oe.default=di,Object.defineProperty(Oe,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
