!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("proxy-compare")):"function"==typeof define&&define.amd?define(["exports","proxy-compare"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).valtioVanilla={},e.proxyCompare)}(this,(function(e,t){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}var r=function(e){return"object"==typeof e&&null!==e},o=new WeakMap,i=new WeakSet,a=function(e,a,c,f,u,s,l,v,d,p){return void 0===e&&(e=Object.is),void 0===a&&(a=function(e,t){return new Proxy(e,t)}),void 0===c&&(c=function(e){return r(e)&&!i.has(e)&&(Array.isArray(e)||!(Symbol.iterator in e))&&!(e instanceof WeakMap)&&!(e instanceof WeakSet)&&!(e instanceof Error)&&!(e instanceof Number)&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof RegExp)&&!(e instanceof ArrayBuffer)}),void 0===f&&(f=function(e){return e.configurable&&e.enumerable&&e.writable}),void 0===u&&(u=function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e}}),void 0===s&&(s=new WeakMap),void 0===l&&(l=function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,n,r){void 0===r&&(r=u);var a=s.get(e);if((null==a?void 0:a[0])===n)return a[1];var c=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));return t.markToTrack(c,!0),s.set(e,[n,c]),Reflect.ownKeys(e).forEach((function(n){if(!Object.getOwnPropertyDescriptor(c,n)){var a=Reflect.get(e,n),f={value:a,enumerable:!0,configurable:!0};if(i.has(a))t.markToTrack(a,!1);else if(a instanceof Promise)delete f.value,f.get=function(){return r(a)};else if(o.has(a)){var u=o.get(a),s=u[0],v=u[1];f.value=l(s,v(),r)}Object.defineProperty(c,n,f)}})),Object.preventExtensions(c)}))),void 0===v&&(v=new WeakMap),void 0===d&&(d=[1,1]),void 0===p&&(p=function(u){if(!r(u))throw new Error("object required");var s=v.get(u);if(s)return s;var y=d[0],b=new Set,g=function(e,t){void 0===t&&(t=++d[0]),y!==t&&(y=t,b.forEach((function(n){return n(e,t)})))},h=d[1],w=function(e){return function(t,n){var r=[].concat(t);r[1]=[e].concat(r[1]),g(r,n)}},j=new Map,O=function(e){var t,n=j.get(e);n&&(j.delete(e),null==(t=n[1])||t.call(n))},P=Array.isArray(u)?[]:Object.create(Object.getPrototypeOf(u)),m=function(n,a,f,u,s){if(!n||!(e(a,u)||v.has(u)&&e(a,v.get(u)))){O(f),r(u)&&(u=t.getUntracked(u)||u);var l=u;if(u instanceof Promise)u.then((function(e){u.status="fulfilled",u.value=e,g(["resolve",[f],e])})).catch((function(e){u.status="rejected",u.reason=e,g(["reject",[f],e])}));else{!o.has(u)&&c(u)&&(l=p(u));var d=!i.has(l)&&o.get(l);d&&function(e,t){if(b.size){var n=t[3](w(e));j.set(e,[t,n])}else j.set(e,[t])}(f,d)}s(l),g(["set",[f],u,a])}},R=a(P,{deleteProperty:function(e,t){var n=Reflect.get(e,t);O(t);var r=Reflect.deleteProperty(e,t);return r&&g(["delete",[t],n]),r},set:function(e,t,n,r){var o=Reflect.has(e,t),i=Reflect.get(e,t,r);return m(o,i,t,n,(function(n){Reflect.set(e,t,n,r)})),!0},defineProperty:function(e,t,r){if(f(r)){var o=Reflect.getOwnPropertyDescriptor(e,t);if(!o||f(o))return m(!!o&&"value"in o,null==o?void 0:o.value,t,r.value,(function(o){Reflect.defineProperty(e,t,n({},r,{value:o}))})),!0}return Reflect.defineProperty(e,t,r)}});v.set(u,R);var k=[P,function(e){return void 0===e&&(e=++d[1]),h===e||b.size||(h=e,j.forEach((function(t){var n=t[0][1](e);n>y&&(y=n)}))),y},l,function(e){b.add(e),1===b.size&&j.forEach((function(e,t){var n=e[0];e[1];var r=n[3](w(t));j.set(t,[n,r])}));return function(){b.delete(e),0===b.size&&j.forEach((function(e,t){var n=e[0],r=e[1];r&&(r(),j.set(t,[n]))}))}}];return o.set(R,k),Reflect.ownKeys(u).forEach((function(e){var t=Object.getOwnPropertyDescriptor(u,e);"value"in t&&(R[e]=u[e],delete t.value,delete t.writable),Object.defineProperty(P,e,t)})),R}),[p,o,i,e,a,c,f,u,s,l,v,d]},c=a()[0];var f=a;e.getVersion=function(e){var t=o.get(e);return null==t?void 0:t[1]()},e.proxy=function(e){return void 0===e&&(e={}),c(e)},e.ref=function(e){return i.add(e),e},e.snapshot=function(e,t){var n=o.get(e),r=n[0],i=n[1];return(0,n[2])(r,i(),t)},e.subscribe=function(e,t,n){var r,i=o.get(e),a=[],c=i[3],f=!1,u=c((function(e){a.push(e),n?t(a.splice(0)):r||(r=Promise.resolve().then((function(){r=void 0,f&&t(a.splice(0))})))}));return f=!0,function(){f=!1,u()}},e.unstable_buildProxyFunction=f}));
